<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/handleEvent_old.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/handleEvent_old.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Function to handle all new information from the listener
 * @param {object} e event from listener
 */

const handleEvent = function(e){
    
    this.eventQueue = [];
    
    let currentTouchBuffer = [];
    
    this.mono=true;
    window.currentPreventDefault = this.preventDefault;
    if(e.type == 'mousedown' || e.type == 'mouseup'){
        this.parseEvent(e, e.type=='mousedown');
        if(this.check(this.status.x, this.status.y)) {
            
            this.eventQueue.push([this.detected,e, this.status.button, this.status])
        };
        e.touches= e.type=='mousedown' ? '.' : ''
        currentTouchBuffer= e.type == 'mousedown' ? [this.detected.id] : [];
    } else if(e.type == 'mousemove'){
        this.parseEvent(e);
        e.touches =this.status.button ? '.' : ''
        
        if(this[this.repetetiveOutput ? 'check' : 'checkNew'](this.status.x, this.status.y)) {
            currentTouchBuffer=[this.detected.id]
            
            this.eventQueue.push([this.detected,e, this.status.button, this.status])
        } else {
            if(!this.check(this.status.x, this.status.y)){
                
                this.eventQueue.push(['default',e,this.status.button,this.status])
            }
        }
   } else if(e.type.includes('touch')){
    this.mono = false;
     if(e.type == 'touchend'){
        Array.from(e.changedTouches).forEach(x=>{
            console.log('ðŸ“–touchbuffer released', x.clientX, x.clientY);
            let matched = Object.entries(this.buffer).filter(y=>y[1].x == x.clientX);
            if(matched.length>0){
                this.rejectedBuffer.push(matched[0][0])
            }
            let e1 = {
                clientX:e.changedTouches[0].clientX,
                clientY:e.changedTouches[0].clientY,
                type:e.type,
                numberOfTouches:e.touches.length
            };
            Object.assign(e1, e);
            this.parseEvent(e1)
            this.eventQueue.push([document.getElementById(matched[0][0]),e1,false, this.status])
        }) 
        
        
       
       
    } else{
        Array.from(e.touches).forEach((touchItem,i)=>{
            let e1 = {
                clientX:touchItem.clientX,
                clientY:touchItem.clientY,
                type:e.type,
                numberOfTouches:e.touches.length
            };
            Object.assign(e1, e);
            
            if(e.type == 'touchstart' ||e.type == 'touchcancel'){
                
                //note: the down parameter will not necessarily be relevant here
                this.parseEvent(e1, e.type=='touchstart');
                
                if(this.check(this.status.x, this.status.y)) {
                    currentTouchBuffer.push(this.detected.id)
                    
                    
                    this.eventQueue.push([this.detected, e1, e.type=='touchstart', this.status])
                } else {
                    // this.action(this.detected, e1, false)
                    
                    this.eventQueue.push([this.detected,e1,false, this.status])
                } 
            }  else if(e.type =='touchmove'){
                this.parseEvent(e1,true);
                this.repetetiveOutput=true;
                
                if(this[this.repetetiveOutput ? 'check' : 'checkNew'](this.status.x, this.status.y)) {
                
                    currentTouchBuffer.push(this.detected.id)
                    
                    if(!this.touchBuffer.includes(this.detected.id))e1.type='touchenter';
                    
                    this.eventQueue.push([this.detected, e1, true,this.status])
                } else {
                    if(!this.check(this.status.x, this.status.y)){
                        
                        this.eventQueue.push('default',e1, false, this.status)
                    }
                }
            } else {
                
            }
        })
    }
        
        
        // check number of touches against item, if number of touches has not changed, and item is in rejectedbuffer, specify leave?

        Object.keys(this.buffer).forEach(x=>{
        
            if(!currentTouchBuffer.includes(x)){
                if(this.eventQueue.filter(event=>event[1].type=='touchend').length>0){
                    let thisItem = this.buffer[x];
                    let endEvents =this.eventQueue.filter(event=>event[1].type=='touchend');
                    
                    
                }
                
                delete this.buffer[x];
                if(!this.rejectedBuffer.includes(x))this.rejectedBuffer.push(x)
        
            }
        })
        
        this.rejectedBuffer.forEach((touchItem,i)=>{
            
            let e1 = {
                clientX:-1,
                clientY:-1,
                type:this.touchNumberBuffer == e.touches.length ? 'touchleave' : 'touchend',
                numberOfTouches:e.touches.length
            };
            this.rejectedBuffer = this.rejectedBuffer.filter(x=>x!=touchItem)
            
            Object.assign(e1, e);
            this.eventQueue.push([document.querySelector(`#${touchItem}`), e1, false, this.status])
        })
        if(Object.keys(this.buffer).length==0) this.actions.default.touch()
    }
   
    
    if(window.currentPreventDefault) {
        e.preventDefault();
    }


    this.eventQueue.forEach(x=>{
        let allowed = true;
        if(Object.keys(this.buffer).includes(x[0].id)){
           
        }
        
        // prevent premature touchends
        if(currentTouchBuffer.includes(x[0].id) &amp;&amp; x[1].type=='touchend'){
            
            allowed = false;
        };
        if(allowed) {
            // todo: retain xy coordinates for note off if possible
            
            this.action(...x)
        }
    })
    this.touchBuffer = currentTouchBuffer;
    
    this.touchNumberBuffer = e.touches.length;
}

module.exports = handleEvent;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MultitouchMapper.html">MultitouchMapper</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addStyles">addStyles</a></li><li><a href="global.html#assignAllowDefault">assignAllowDefault</a></li><li><a href="global.html#comp">comp</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#getListOfElements">getListOfElements</a></li><li><a href="global.html#handleEvent">handleEvent</a></li><li><a href="global.html#listen">listen</a></li><li><a href="global.html#matchActions">matchActions</a></li><li><a href="global.html#setAction">setAction</a></li><li><a href="global.html#setActionsAsDictionary">setActionsAsDictionary</a></li><li><a href="global.html#setDefaultAction">setDefaultAction</a></li><li><a href="global.html#unlisten">unlisten</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Thu Dec 01 2022 16:58:53 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
