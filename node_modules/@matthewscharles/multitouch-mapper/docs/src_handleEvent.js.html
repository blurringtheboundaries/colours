<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/handleEvent.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/handleEvent.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const emit = require('@matthewscharles/cm-toolbox').emit;


/**
 * Function to handle all new information from the listener
 * @param {object} e event from listener
 */

const handleEvent = function(e) {

    this.mono = false;
    window.currentPreventDefault = this.preventDefault;

    let event = e;
    if(e.type.includes('mouse')){
      if(e.type=='mousedown'){
        e = {
          type:'touchstart',
          changedTouches:[
            {
              identifier:'mouse',
              clientX:e.clientX,
              clientY:e.clientY,
              preventDefault:function(e){
                e.preventDefault()
              }.bind(e)
            }
          ]
        }
      } else if(e.type=='mousemove' &amp;&amp; e.buttons>0){
        e = {
          type:'touchmove',
          touches:[
            {
              identifier:'mouse',
              clientX:e.clientX,
              clientY:e.clientY,
              preventDefault:function(e){
                e.preventDefault()
              }.bind(e)
            }
          ]
        }
       } else if(e.type=='mouseup'){
          e = {
            type:'touchend',
            changedTouches:[
              {
                identifier:'mouse',
                clientX:e.clientX,
                clientY:e.clientY,
                preventDefault:function(e){
                  e.preventDefault()
                }.bind(e)
              }
            ]
          }
        }
      }
    
    if (e.type == 'touchstart') {
      if(Object.keys(this.buffer).length==0) this.touchStartTime = Date.now();
      Array.from(e.changedTouches).forEach(x => {
        
        this.buffer[x.identifier] = {
          elements: {},
          history: {}
        }
  
        let newTouch = this.getListOfElements(x.clientX, x.clientY)
          .slice(0,this.depth);
        
        newTouch.forEach((item, i) => {
          this.processElement(item, x.identifier, i, 'start', e, x)
        });
        
      })
  
    } else if (e.type == 'touchmove') {
  
      Array.from(e.touches).forEach(x => {

        let identifiedElements = []
        let newTouch = this.getListOfElements(x.clientX, x.clientY)
          .slice(0,this.depth);
  

        // todo: if mouse and mouse is down, drag
        // todo: use time threshold / timeout to set a touched item as dragged

        newTouch.forEach((item, i) => {
          if (this.processElement(item, x.identifier, i, 'move', e, x)) identifiedElements.push(item.id)
        })

        // todo: incorporate mouseover
        
        if(Object.keys(this.buffer).length>0){
          
          Object.entries(this.buffer[x.identifier].elements).forEach(([item, contents], i) => {
            
            if (!identifiedElements.includes(item)) {
              this.buffer[x.identifier].history[item] = this.buffer[x.identifier].elements[item];
              this.processElement(contents.query, x.identifier, i, 'leave', e, x, item)
              delete this.buffer[x.identifier].elements[item];
            }

          })

        }

      })
  
  
    } else if (e.type == 'touchend') {
      
      Array.from(e.changedTouches).forEach(x => {
        Object.entries(this.buffer[x.identifier].elements).forEach(([item, contents], i) => {
          this.processElement(contents.query, x.identifier, i, 'end', e, x, item)
        })
  
        delete this.buffer[x.identifier];
  
      })
    }
    
    this.eventQueue.forEach(([index, type, element, e, obj]) => {
      if(typeof this.actions[index][type] == 'function') this.actions[index][type](element, e, obj);
      if(this.customEvent.enabled){
        emit(this.customEvent.name,obj);
      }
    })
  
    this.eventQueue = [];

    if(window.currentPreventDefault) {
      event.preventDefault();
    }

  }
  
module.exports = handleEvent;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="MultitouchMapper.html">MultitouchMapper</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addStyles">addStyles</a></li><li><a href="global.html#assignAllowDefault">assignAllowDefault</a></li><li><a href="global.html#comp">comp</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#getListOfElements">getListOfElements</a></li><li><a href="global.html#handleEvent">handleEvent</a></li><li><a href="global.html#listen">listen</a></li><li><a href="global.html#matchActions">matchActions</a></li><li><a href="global.html#setAction">setAction</a></li><li><a href="global.html#setActionsAsDictionary">setActionsAsDictionary</a></li><li><a href="global.html#setDefaultAction">setDefaultAction</a></li><li><a href="global.html#unlisten">unlisten</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Mar 16 2023 17:19:05 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
