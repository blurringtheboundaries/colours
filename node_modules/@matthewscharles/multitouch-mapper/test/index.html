<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width">
    <link rel="stylesheet" href="./style.css">
    <title>multitouch-mapper test page: keyboard </title>
    <script src="./main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
</head>

<body>
    <h1 class="touch_pickup_ignore">multitouch-mapper test page</h1><select class="allowDefault" id="test">
        <option>test 1</option>
        <option>testing</option>
    </select>
    <div id="instrument">
        <div class="prevent-select" id="keyboard">
            <div id="whiteKeys_under"></div>
            <div id="blackKeys_under"></div>
            <div id="whiteKeys">
                <div id="group_C1">
                    <div class="under" id="C1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 0px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="C1" data-colour="white" data-note="60" data-notename="C" role="button" aria-label="C-4" style="border-style: solid; border-width: 2px; position: absolute; left: 0px; width: 30px; height: 130px; background-color: red;" aria-hidden="true"></div>
                </div>
                <div id="group_D1">
                    <div class="under" id="D1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 30px; width: 30px; height: 130px; background-color:white;"></div>
                    <div class="visual" id="D1" data-colour="white" data-note="62" data-notename="D" role="button" aria-label="D-4" style="border-style: solid; border-width: 2px; position: absolute; left: 30px; width: 30px; height: 130px; background-color: orange;" aria-hidden="true"></div>
                </div>
                <div id="group_E1">
                    <div class="under" id="E1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 60px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="E1" data-colour="white" data-note="64" data-notename="E" role="button" aria-label="E-4" style="border-style: solid; border-width: 2px; position: absolute; left: 60px; width: 30px; height: 130px; background-color: yellow;" aria-hidden="true"></div>
                </div>
                <div id="group_F1">
                    <div class="under" id="F1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 90px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="F1" data-colour="white" data-note="65" data-notename="F" role="button" aria-label="F-4" style="border-style: solid; border-width: 2px; position: absolute; left: 90px; width: 30px; height: 130px; background-color: yellowgreen;" aria-hidden="true"></div>
                </div>
                <div id="group_G1">
                    <div class="under" id="G1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 120px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="G1" data-colour="white" data-note="67" data-notename="G" role="button" aria-label="G-4" style="border-style: solid; border-width: 2px; position: absolute; left: 120px; width: 30px; height: 130px; background-color: lightseagreen;" aria-hidden="true"></div>
                </div>
                <div id="group_A1">
                    <div class="under" id="A1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 150px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="A1" data-colour="white" data-note="69" data-notename="A" role="button" aria-label="A-4" style="border-style: solid; border-width: 2px; position: absolute; left: 150px; width: 30px; height: 130px; background-color: blueviolet;" aria-hidden="true"></div>
                </div>
                <div id="group_B1">
                    <div class="under" id="B1_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 180px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="B1" data-colour="white" data-note="71" data-notename="B" role="button" aria-label="B-4" style="border-style: solid; border-width: 2px; position: absolute; left: 180px; width: 30px; height: 130px; background-color: purple;" aria-hidden="true"></div>
                </div>
                <div id="group_C2">
                    <div class="under" id="C2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 210px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="C2" data-colour="white" data-note="72" data-notename="C" role="button" aria-label="C-5" style="border-style: solid; border-width: 2px; position: absolute; left: 210px; width: 30px; height: 130px; background-color: red;" aria-hidden="true"></div>
                </div>
                <div id="group_D2">
                    <div class="under" id="D2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 240px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="D2" data-colour="white" data-note="74" data-notename="D" role="button" aria-label="D-5" style="border-style: solid; border-width: 2px; position: absolute; left: 240px; width: 30px; height: 130px; background-color: orange;" aria-hidden="true"></div>
                </div>
                <div id="group_E2">
                    <div class="under" id="E2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 270px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="E2" data-colour="white" data-note="76" data-notename="E" role="button" aria-label="E-5" style="border-style: solid; border-width: 2px; position: absolute; left: 270px; width: 30px; height: 130px; background-color: yellow;" aria-hidden="true"></div>
                </div>
                <div id="group_F2">
                    <div class="under" id="F2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 300px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="F2" data-colour="white" data-note="77" data-notename="F" role="button" aria-label="F-5" style="border-style: solid; border-width: 2px; position: absolute; left: 300px; width: 30px; height: 130px; background-color: yellowgreen;" aria-hidden="true"></div>
                </div>
                <div id="group_G2">
                    <div class="under" id="G2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 330px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="G2" data-colour="white" data-note="79" data-notename="G" role="button" aria-label="G-5" style="border-style: solid; border-width: 2px; position: absolute; left: 330px; width: 30px; height: 130px; background-color: lightseagreen;" aria-hidden="true"></div>
                </div>
                <div id="group_A2">
                    <div class="under" id="A2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 360px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="A2" data-colour="white" data-note="81" data-notename="A" role="button" aria-label="A-5" style="border-style: solid; border-width: 2px; position: absolute; left: 360px; width: 30px; height: 130px; background-color: blueviolet;" aria-hidden="true"></div>
                </div>
                <div id="group_B2">
                    <div class="under" id="B2_under" data-colour="white" aria-hidden="true" style="border-style: none; position: absolute; left: 390px; width: 30px; height: 130px; background-color: white;"></div>
                    <div class="visual" id="B2" data-colour="white" data-note="83" data-notename="B" role="button" aria-label="B-5" style="border-style: solid; border-width: 2px; position: absolute; left: 390px; width: 30px; height: 130px; background-color: purple;" aria-hidden="true"></div>
                </div>
            </div>
            <div id="blackKeys">
                <div id="group_Csharp1">
                    <div class="under" id="Csharp1_under" data-colour="black" style="border-style: none; position: absolute; left: 20px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Csharp1" data-colour="black" data-note="61" data-notename="C sharp" role="button" aria-label="C-sharp-4" style="border-style: solid; border-width: 2px; position: absolute; left: 20px; width: 20px; height: 70px; background-color: orangered;" aria-hidden="true"></div>
                </div>
                <div id="group_Dsharp1">
                    <div class="under" id="Dsharp1_under" data-colour="black" style="border-style: none; position: absolute; left: 50px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Dsharp1" data-colour="black" data-note="63" data-notename="D sharp" role="button" aria-label="D-sharp-4" style="border-style: solid; border-width: 2px; position: absolute; left: 50px; width: 20px; height: 70px; background-color: gold;" aria-hidden="true"></div>
                </div>
                <div id="group_Fsharp1">
                    <div class="under" id="Fsharp1_under" data-colour="black" style="border-style: none; position: absolute; left: 110px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Fsharp1" data-colour="black" data-note="66" data-notename="F sharp" role="button" aria-label="F-sharp-4" style="border-style: solid; border-width: 2px; position: absolute; left: 110px; width: 20px; height: 70px; background-color: green;" aria-hidden="true"></div>
                </div>
                <div id="group_Gsharp1">
                    <div class="under" id="Gsharp1_under" data-colour="black" style="border-style: none; position: absolute; left: 140px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Gsharp1" data-colour="black" data-note="68" data-notename="G sharp" role="button" aria-label="G-sharp-4" style="border-style: solid; border-width: 2px; position: absolute; left: 140px; width: 20px; height: 70px; background-color: blue;" aria-hidden="true"></div>
                </div>
                <div id="group_Asharp1">
                    <div class="under" id="Asharp1_under" data-colour="black" style="border-style: none; position: absolute; left: 170px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Asharp1" data-colour="black" data-note="70" data-notename="A sharp" role="button" aria-label="A-sharp-4" style="border-style: solid; border-width: 2px; position: absolute; left: 170px; width: 20px; height: 70px; background-color: rebeccapurple;" aria-hidden="true"></div>
                </div>
                <div id="group_Csharp2">
                    <div class="under" id="Csharp2_under" data-colour="black" style="border-style: none; position: absolute; left: 230px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Csharp2" data-colour="black" data-note="73" data-notename="C sharp" role="button" aria-label="C-sharp-5" style="border-style: solid; border-width: 2px; position: absolute; left: 230px; width: 20px; height: 70px; background-color: orangered;" aria-hidden="true"></div>
                </div>
                <div id="group_Dsharp2">
                    <div class="under" id="Dsharp2_under" data-colour="black" style="border-style: none; position: absolute; left: 260px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Dsharp2" data-colour="black" data-note="75" data-notename="D sharp" role="button" aria-label="D-sharp-5" style="border-style: solid; border-width: 2px; position: absolute; left: 260px; width: 20px; height: 70px; background-color: gold;" aria-hidden="true"></div>
                </div>
                <div id="group_Fsharp2">
                    <div class="under" id="Fsharp2_under" data-colour="black" style="border-style: none; position: absolute; left: 320px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Fsharp2" data-colour="black" data-note="78" data-notename="F sharp" role="button" aria-label="F-sharp-5" style="border-style: solid; border-width: 2px; position: absolute; left: 320px; width: 20px; height: 70px; background-color: green;" aria-hidden="true"></div>
                </div>
                <div id="group_Gsharp2">
                    <div class="under" id="Gsharp2_under" data-colour="black" style="border-style: none; position: absolute; left: 350px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Gsharp2" data-colour="black" data-note="80" data-notename="G sharp" role="button" aria-label="G-sharp-5" style="border-style: solid; border-width: 2px; position: absolute; left: 350px; width: 20px; height: 70px; background-color: blue;" aria-hidden="true"></div>
                </div>
                <div id="group_Asharp2">
                    <div class="under" id="Asharp2_under" data-colour="black" style="border-style: none; position: absolute; left: 380px; width: 20px; height: 70px; background-color: black;"></div>
                    <div class="visual" id="Asharp2" data-colour="black" data-note="82" data-notename="A sharp" role="button" aria-label="A-sharp-5" style="border-style: solid; border-width: 2px; position: absolute; left: 380px; width: 20px; height: 70px; background-color: rebeccapurple;" aria-hidden="true"></div>
                </div>
            </div>
        </div><canvas id="cover"></canvas>
    </div>
    <script>
        document.querySelector('#test').addEventListener('input', function(e) {
            console.log(this.value)
        })
        // some items that can be handled by the ScreenInstrument class in a future demo..
        const synth = new Tone.PolySynth().set({
            oscillator: {
                type: 'sine2',
                volume: -16
            }
        }).toDestination();

        const allOff = function() {
            document.querySelectorAll('.visual').forEach(x => {
                x.style.transition = 'all 0.1s ease'
                x.style.borderWidth = '2px'
                x.style.opacity = 1;
            });

            synth.releaseAll();
        }

        const playNote = function(id, triggerType) {
            synth[triggerType](Tone.Frequency(id.replace('sharp', '#')).transpose(36));
        }

        // ---------------------------------setup---------------------------------

        multitouchMapper
            .listen()
            .addStyles()
            .setDefaultAction(allOff)



        // set multiple actions by providing a dictionary as the second argument
        multitouchMapper.setAction('.visual', {
            start: function(element, e, obj) {
                Tone.start();
                playNote(element.id, 'triggerAttack');
                Object.assign(element.style, {
                    transition: 'all 0.1s ease',
                    borderWidth: '3px',
                    opacity: 0.6
                })
            },
            enter: function(element, e, obj) {
                Tone.start();
                playNote(element.id, 'triggerAttack');
                Object.assign(element.style, {
                    transition: 'all 0.1s ease',
                    borderWidth: '3px',
                    opacity: 0.6
                })
            },
            end: function(element, e, obj) {
                playNote(element.id, 'triggerRelease');
                Object.assign(element.style, {
                    transition: 'all 0.1s ease',
                    borderWidth: '2px',
                    opacity: 1
                })
            },
            leave: function(element, e, obj) {
                playNote(element.id, 'triggerRelease');
                Object.assign(element.style, {
                    transition: 'all 0.1s ease',
                    borderWidth: '2px',
                    opacity: 1
                })
            }
            //- touch: function(element,e,down,status){
            //-     let triggerType = down ? 'triggerAttack':'triggerRelease';
            //-     Tone.start(); 
            //-     playNote(element.id, triggerType)
            //-     Object.assign(element.style,{
            //-         transition: 'all 0.1s ease',
            //-         borderWidth: down ? '3px' : '2px',
            //-         opacity: down ? 0.9 : 1
            //-     })
            //- }.bind(multitouchMapper),

        })

        // testing a new way of handling events...
        document.addEventListener('touch-pickup', (e) => {
            console.log(e.detail)
        })
    </script>
</body>

</html>