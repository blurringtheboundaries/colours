import { createNS } from './createNS.js';
import { createAnimation } from './createAnimation.js';

// const createNS = require('./createNS');
// const createAnimation = require('./createAnimation');

/**
 * Create a filter with some defaults
 * @param {*} id 
 * @param {*} matrix string or array of strings
 * @returns {object} SVG filter element
 */

const createFilter = function(id, matrix){
    let output={
        filter: createNS('filter',{
            id:id,
            custom:{
                filterUnits: "objectBoundingBox",
                x: "0",
                y: "0",
                width:"100%",
                height:"100%"
            }
        }),
        animation:{
            
        },
        update:{

        }
    }
    if(typeof matrix=='string') matrix = [matrix]
    
    matrix.forEach(x=>{
        output[x] = createNS('feColorMatrix',{
            id:`${id}_${x}`,
            custom:{
                type:matrix,
                in:'SourceGraphic',
                values:0
            }
            

        })
        output.filter.appendChild(output[x]);
        output.animation[x] = createAnimation('values',[[0,0],[1,1]],0.1);
        output[x].appendChild(output.animation[x])
        output.update[x] = function(to, time='unspecified', from='unspecified'){
         if(from=='unspecified') from = output[x].values.animVal.getItem('value').value
         if(time!='unspecified') output.animation[x].setAttribute('dur', `${time}s`)
         output.animation[x].setAttribute('values', `${from};${to}`)
         console.log(output.animation[x])
         output.animation[x].beginElement();
       }

    })
    
    return output;
}

// todo: add animation trigger
// const triggerAnimation = function(to, from=instrument.bars[5].screenElement.container.querySelector('filter feColorMatrix').values.animVal.getItem('value').value){
//     instrument.bars[5].screenElement.smil.saturate.setAttribute('values', `${from};${to/100}`)
//     instrument.bars[5].screenElement.smil.saturate.beginElement();
//   }


// module.exports = createFilter;

export { createFilter }