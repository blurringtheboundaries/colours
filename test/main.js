(()=>{var e={441:(e,t,s)=>{const n=function(){this.listen()};(n.prototype={listeners:["mousemove","mousedown","mouseup","mouseleave","touchstart","touchmove","touchend","touchcancel"],eventQueue:[],depth:1,preventDefault:!0,mono:!0,buffer:{},rejectedBuffer:[],touchStartTime:0,target:document,debounce:!0,customEvent:{enabled:!0,name:"touch-pickup"},classes:{allow:"allowDefault",prevent:"preventDefault"},actions:{default:{touch:(e,t,s)=>{},hover:(e,t,s)=>{},drag:(e,t,s)=>{},leave:(e,t,s)=>{},enter:(e,t,s)=>{},start:(e,t,s)=>{},end:(e,t,s)=>{}},".allowDefault":{start:function(){window.currentPreventDefault=!1},hover:function(){window.currentPreventDefault=!1},move:function(){window.currentPreventDefault=!1},drag:function(){window.currentPreventDefault=!1},leave:function(){window.currentPreventDefault=!1},enter:function(){window.currentPreventDefault=!1},end:function(){window.currentPreventDefault=!1}},".preventDefault":{touch:function(e,t,s){t.preventDefault()},hover:function(e,t,s){t.preventDefault()},move:function(){window.currentPreventDefault=!1},drag:function(e,t,s){t.preventDefault()},leave:function(e,t,s){t.preventDefault()},enter:function(e,t,s){t.preventDefault()},end:function(){window.currentPreventDefault=!1}}}}).constructor=n,["getListOfElements","matchActions","handleEvent","listen","unlisten","processElement","setDefaultAction","setAction","setActionsAsDictionary","assignAllowDefault","addStyles"].forEach((e=>n.prototype[e]=s(905)(`./${e}`))),e.exports=n},762:e=>{e.exports=function(){return this.stylesheet=document.createElement("style"),this.stylesheet.innerHTML=`.${this.classes.detect}{\n        pointer-events:auto;\n        touch-action:none;\n    }\n        \n.\n    ${this.classes.ignore}{\n        pointer-events:none;\n        touch-action:none;\n    }`,document.querySelector("head").appendChild(this.stylesheet),this}},562:e=>{e.exports=function(e={},t="add"){return e.querySelectorAll("*").forEach((e=>{e.classList[t](this.classes.allow)})),this}},841:e=>{e.exports=function(e,t,s=document){let n=s.elementsFromPoint(e,t);return n=Array.from(n).filter((e=>this.matchActions(e))),n=n.slice(0,this.depth),n}},378:(e,t,s)=>{const n=s(797).j8;e.exports=function(e){this.mono=!1,window.currentPreventDefault=this.preventDefault;let t=e;e.type.includes("mouse")&&("mousedown"==e.type?e={type:"touchstart",changedTouches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]}:"mousemove"==e.type&&e.buttons>0?e={type:"touchmove",touches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]}:"mouseup"==e.type&&(e={type:"touchend",changedTouches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]})),"touchstart"==e.type?(0==Object.keys(this.buffer).length&&(this.touchStartTime=Date.now()),Array.from(e.changedTouches).forEach((t=>{this.buffer[t.identifier]={elements:{},history:{}},this.getListOfElements(t.clientX,t.clientY).slice(0,this.depth).forEach(((s,n)=>{this.processElement(s,t.identifier,n,"start",e,t)}))}))):"touchmove"==e.type?Array.from(e.touches).forEach((t=>{let s=[];this.getListOfElements(t.clientX,t.clientY).slice(0,this.depth).forEach(((n,i)=>{this.processElement(n,t.identifier,i,"move",e,t)&&s.push(n.id)})),Object.keys(this.buffer).length>0&&Object.entries(this.buffer[t.identifier].elements).forEach((([n,i],o)=>{s.includes(n)||(this.buffer[t.identifier].history[n]=this.buffer[t.identifier].elements[n],this.processElement(i.query,t.identifier,o,"leave",e,t,n),delete this.buffer[t.identifier].elements[n])}))})):"touchend"==e.type&&Array.from(e.changedTouches).forEach((t=>{Object.entries(this.buffer[t.identifier].elements).forEach((([s,n],i)=>{this.processElement(n.query,t.identifier,i,"end",e,t,s)})),delete this.buffer[t.identifier]})),this.eventQueue.forEach((([e,t,s,i,o])=>{"function"==typeof this.actions[e][t]&&this.actions[e][t](s,i,o),this.customEvent.enabled&&n(this.customEvent.name,o)})),this.eventQueue=[],window.currentPreventDefault&&t.preventDefault()}},447:e=>{e.exports=function(e=document){for(let t of this.listeners)e.addEventListener(t,this,!1);return console.log(`multitouch mapper listening on ${e==document?"document":e.id}...`),this}},796:e=>{e.exports=function(e){let t=!1;return Object.keys(this.actions).forEach(((s,n)=>{"object"==typeof e?e.matches(s)&&(t=!0):"string"==typeof e&&e==s&&(t=!0)})),t}},384:e=>{e.exports=function(e,t,s,n,i,o,r){let c=!1;return Object.entries(this.actions).forEach((([s,a],h)=>{let l=!1;if("object"==typeof e?(l=e.matches(s),r=e.id):"string"==typeof e&&(l=e==s,e=document.querySelector(`#${r}`)),l){let a=this.buffer[t].elements;const h=e.getBoundingClientRect();Object.keys(a).includes(r)?"move"==n?(a[r].type="move",a[r].query=s,a[r].delta.x=o.clientX-a[r].x,a[r].delta.y=o.clientY-a[r].y,a[r].path.x.push(o.clientX),a[r].path.y.push(o.clientY),a[r].x=o.clientX,a[r].y=o.clientY,a[r].relative.x=o.clientX-h.left,a[r].relative.y=h.bottom-o.clientY,a[r].distance.x=o.clientX-a[r].origin.x,a[r].distance.y=o.clientY-a[r].origin.y,a[r].iterations+=1):"end"==n?a[r].type="end":"leave"==n&&(a[r].type="leave"):a[r]={id:r,element:e,time:Date.now(),type:"start"==n?"start":"enter",x:o.clientX,y:o.clientY,query:s,iterations:0,rect:{original:h,current:h},origin:{x:o.clientX,y:o.clientY},relative:{x:o.clientX-h.left,y:h.bottom-o.clientY,range:{x:h.width,y:h.height}},distance:{x:0,y:0},path:{x:[o.clientX],y:[o.clientY]},delta:{x:0,y:0}},this.eventQueue.push([s,a[r].type,e,i,a[r]]),c=!0}})),c}},807:e=>{e.exports=function(e,t,s){return Object.keys(this.actions).includes(e)||(this.actions[e]={}),Object.assign(this.actions[e],{start:function(e,t,s){},enter:function(e,t,s){},move:function(e,t,s){},leave:function(e,t,s){},end:function(e,t,s){}}),"object"==typeof t?this.setActionsAsDictionary(e,t):"string"==typeof t&&("all"==t?Object.keys(this.actions[e]).forEach((t=>{this.actions[e][t]=s.bind(this)})):this.actions[e][t]=s.bind(this)),this}},21:e=>{e.exports=function(e,t={}){return Object.entries(t).forEach((([t,s])=>{this.actions[e][t]=s})),this}},838:e=>{e.exports=function(e){return this.setAction("default","all",e),this}},411:e=>{e.exports=function(e=document){for(let t of this.listeners)e.removeEventListener(t,this);return console.log(`removed multitouch mapper listener on ${e==document?"document":e.id}...`),this}},905:(e,t,s)=>{var n={"./addStyles":762,"./addStyles.js":762,"./assignAllowDefault":562,"./assignAllowDefault.js":562,"./getListOfElements":841,"./getListOfElements.js":841,"./handleEvent":378,"./handleEvent.js":378,"./listen":447,"./listen.js":447,"./matchActions":796,"./matchActions.js":796,"./processElement":384,"./processElement.js":384,"./setAction":807,"./setAction.js":807,"./setActionsAsDictionary":21,"./setActionsAsDictionary.js":21,"./setDefaultAction":838,"./setDefaultAction.js":838,"./unlisten":411,"./unlisten.js":411};function i(e){var t=o(e);return s(t)}function o(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=905},876:(e,t,s)=>{class n{constructor(e=["all"]){this.devices=e,this.map={},this.init()}}["process","init","success","failure","listen","assign","assignRange","getRanges","processRange","processNote"].forEach((e=>{n.prototype[e]=s(492)(`./${e}`)})),e.exports=n},720:e=>{e.exports=function(e,t,s,n){if(16==e)for(let e=0;e<16;e++)this.map[e][t][s]=n;else this.map[e][t][s]=n}},583:()=>{},444:e=>{e.exports=function(e,t,s){"full"!=t&&"all"!=t||(t="0,127"),this.map[e].noteRange[t]=s}},691:e=>{e.exports=function(){console.log("No MIDI device available")}},254:e=>{e.exports=function(e,t,s){return Object.entries(this.map[e].noteRange).filter((([e,s])=>{let n=e.split(",").map((e=>parseFloat(e)));return t>=n[0]&&t<=n[1]})).map((e=>e[1]))}},91:e=>{e.exports=function(){for(let e=0;e<16;e++){this.map[e]={},this.map[e].cc=[],this.map[e].note=[],this.map[e].noteOff=[],this.map[e].noteRange={};for(let t=0;t<128;t++)this.map[e].cc[t]=function(){},this.map[e].note[t]=function(){},this.map[e].noteOff[t]=function(){}}}},919:e=>{e.exports=function(){navigator.requestMIDIAccess().then(this.success.bind(this),this.failure.bind(this))}},250:e=>{e.exports=function(e){let[t,s,n]=e.data;if(t>=176&&t<=191){let e=t-176;console.log("channel:",t-175,"cc:",s,"value:",n),this.map[e].cc[s](n)}else if(t>=144&&t<=159){let e=t-144;this.processNote(e,s,n),this.map[e].note[s](n)}else if(t>=128&&t<=143){let e=t-128;"undefined"==n&&(n=0),this.map[e].noteOff[s](0)}}},371:e=>{e.exports=function(e,t,s){this.processRange(this.getRanges(...arguments),t,s)}},335:e=>{e.exports=function(e,t,s){e.forEach((e=>e(t,s)))}},904:e=>{e.exports=function(e){for(let t of e.inputs.values())t.onmidimessage=this.process.bind(this),console.log("MIDI Mapper listening:",t.name,t)}},492:(e,t,s)=>{var n={"./assign":720,"./assign.js":720,"./assignCC":583,"./assignCC.js":583,"./assignRange":444,"./assignRange.js":444,"./failure":691,"./failure.js":691,"./getRanges":254,"./getRanges.js":254,"./init":91,"./init.js":91,"./listen":919,"./listen.js":919,"./process":250,"./process.js":250,"./processNote":371,"./processNote.js":371,"./processRange":335,"./processRange.js":335,"./success":904,"./success.js":904};function i(e){var t=o(e);return s(t)}function o(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=492},797:(e,t,s)=>{"use strict";s.d(t,{j8:()=>h});var n=function(e,t){Object.entries(t).forEach((t=>{let[s,n]=t;switch(s){case"custom":Object.entries(n).forEach((t=>e.setAttribute(...t)));break;case"style":Object.entries(n).forEach((t=>e.style[t[0]]=t[1]));break;case"dataset":Object.entries(n).forEach((t=>e.dataset[t[0]]=t[1]));break;default:e[s]=n}}))},i=i||"http://www.w3.org/2000/svg",o=function(e,t,s=document){let o=s.createElementNS(i,e);return n(o,t),o},r=function(e,t,s,n={},i){i||"undefined"==typeof document||(i=document);let r={custom:{attributeName:"fill",begin:"indefinite",repeatCount:"1",dur:"1s",fill:"freeze",keyTimes:"0; 1",values:"red; blue"}};"object"==typeof arguments[0]&&(Object.assign(r.custom,arguments[0].custom),"dur"in r.custom||(r.custom.dur=`${arguments[0].duration}s`),t=arguments[0].events,s=arguments[0].duration,arguments.length>1&&(i=arguments[1]));let c="",a="";if(!Array.isArray(t)){let e=[];Object.keys(t).forEach((s=>{e.push([s,t[s]])})),(t=e).sort(((e,t)=>e[0]-t[0]))}t.forEach((([e,s],n)=>{parseFloat(e)%1==0&&(e+=".00");let i=n<Object.keys(t).length-1?"; ":"";a+=`${e}${i}`,c+=`${s}${i}`})),r.custom.values=c,r.custom.keyTimes=a;let h=o("translate"==e?"animateTransform":"animate",r,i);return h=Object.assign(h,n),h},c=function(e,t,s,n=!1){return(e=n?Math.floor(e):e)>s?s:e<t?t:e},a=function(e,t,s){s||"undefined"==typeof document||(s=document);let i=s.createElement(e);return n(i,t),i};const h=function(e,t={}){document.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))};var l=function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toFrequency()},u=function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toFrequency()};function f(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","filter");return s.setAttribute("id",e),s.setAttribute("filterUnits",t),s}function p(e,t,s){const n=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");return n.setAttribute("id",e),n.setAttribute("type",t),n.setAttribute("values",s),n}function d(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");return t.setAttribute("id",e),t}function m(e){const t=document.createElementNS("http://www.w3.org/2000/svg","animate");return Object.keys(e).forEach((s=>{t.setAttribute(s,e[s])})),t}function y(e){const t=f(e.id,e.filterUnits),s=d("feComponentTransfer1");return t.appendChild(s),Object.keys(e.components).forEach((s=>{const n=e.components[s],i=p(n.id,n.type,n.values);t.appendChild(i)})),Object.keys(e.animations).length>0&&Object.keys(e.animations).forEach((s=>{const n=m(e.animations[s]);t.appendChild(n)})),t}function g(e){return parseInt(e,16)/255}function b(e){let t=Math.round(255*e).toString(16);return t=1===t.length?`0${t}`:t,t}const v=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e);console.log("running cm-toolbox");var w={CSSToggle:class{constructor(e,t=!1,s=.1,n=.3,i="hc--light",o="fill"){this.element=e,this.on=t,this.attack=s,this.release=n,this.effectClass=i}toggle(){this.on=!this.on;let{element:e,on:t,attack:s,release:n,effectClass:i}=this;e.style.transition=`fill ${t?s:n}s ease`,e.classList[t?"add":"remove"](i)}trigger(e,t=!0){this.on=e;let{element:s,attack:n,release:i,effectClass:o}=this;s.style.transition=`fill ${e?n:i}s ease`,s.classList[e?"add":"remove"](o)}set attack(e){this._attack=e}set release(e){this._release=e}},addAnimation:function(e,t,s,n,i={},o){o||"undefined"==typeof document||(o=document);let c,a="object"==typeof e?e:o.getElementById(e);if("object"==typeof arguments[1]){let e={custom:{}};Object.assign(e,arguments[1]),arguments.length>2&&(o=arguments[2]),"id"in e.custom||(e.custom.id=`${a.id}_${t}`),c=r(e,o)}else"id"in i||(i.id=`${a.id}_${t}`),c=r(t,s,n,i,o);return a.appendChild(c),c},constrain:c,create:a,createFilter:function(e,t){let s={filter:o("filter",{id:e,custom:{filterUnits:"objectBoundingBox",x:"0",y:"0",width:"100%",height:"100%"}}),animation:{},update:{}};return"string"==typeof t&&(t=[t]),t.forEach((n=>{s[n]=o("feColorMatrix",{id:`${e}_${n}`,custom:{type:t,in:"SourceGraphic",values:0}}),s.filter.appendChild(s[n]),s.animation[n]=r("values",[[0,0],[1,1]],.1),s[n].appendChild(s.animation[n]),s.update[n]=function(e,t="unspecified",i="unspecified"){"unspecified"==i&&(i=s[n].values.animVal.getItem("value").value),"unspecified"!=t&&s.animation[n].setAttribute("dur",`${t}s`),s.animation[n].setAttribute("values",`${i};${e}`),console.log(s.animation[n]),s.animation[n].beginElement()}})),s},createAnimation:r,createNS:o,emit:h,ftos:function(e,t=0){return sym=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toNote()},getTranslate:e=>{const t=getComputedStyle(e).transform,{e:s,f:n}="none"==t?{e:0,f:0}:new DOMMatrix(t);return{x:s,y:n}},hexToInt:function(e){let t=[0,0];for(let s=0;s<2;s++)t[s]=e.charCodeAt(s),t[s]-=t[s]>=65?55:48;return t[0]*=16,t[0]+t[1]},interpolate:function(e,t,s,n=!1){let i=(1-s)*e+s*t;return i=n?Math.floor(i):i,i},intToHex:function(e){let t=[0,0];t[0]=Math.floor(e/16),t[1]=e%16;for(let e in t)t[e]=t[e]>9?String.fromCharCode(t[e]+55):t[e];return`${t[0]}${t[1]}`},map:function(e,t,s,n,i,o=!1,r=!1){return e-=t,e*=i-n,e/=s-t,e+=t,e=r?Math.floor(e):e,o?c(e,n,i):e},mtof:l,mtos:function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toNote()},populate:function(e,t,s=!1,n="option"){t.forEach((t=>{e.appendChild(a(n,{value:t,innerHTML:t})),0!=s&&(e.value=s)}))},rot:function(e,t){let s=[e.slice(t),e.slice(0,t)];return s[0].concat(s[1])},set:n,setInTree:function(e=[],t=0,s=this){"string"==typeof e&&(e=e.split("_"));var n=s;e.forEach(((e,t,s)=>{t<s.length-1&&(n=n[e])})),console.log(n,t),n[e[e.length-1]]=t},setNS:function(e,t){Object.entries(t).forEach((t=>{let[s,n]=t;switch(s){case"custom":Object.entries(n).forEach((t=>{e.setAttributeNS(xmlns,...t)}));break;case"style":Object.entries(n).forEach((t=>e.style[t[0]]=t[1]));break;default:e[s]=n}}))},stom:function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toMidi()},stof:u,toggleFullscreen:()=>document.fullscreenElement?(document.exitFullscreen(),!0):document.webkitFullscreenElement?(document.webkitExitFullscreen(),!0):document.documentElement.requestFullscreen?(document.documentElement.requestFullscreen(),!0):document.documentElement.webkitRequestFullscreen?(document.documentElement.webkitRequestFullscreen(),!0):(window.top!=window.self?window.top.location.href=window.location.href:window.history.back(),!1),transposeForPlayer:function(e,t){return"string"==typeof e?e=u(e):"number"==typeof e&&(e=l(e)),"string"==typeof t?t=u(t):"number"==typeof t&&(t=l(t)),e/t},v:function(e){return Tone.gainToDb(e)},within:function(e=0,t=0,s={left:0,right:0,top:0,bottom:0}){let n={left:e>=s.left,right:e<=s.right,top:t>=s.top,bottom:t<=s.bottom},i=[];return Object.keys(s).forEach((e=>{e in n&&i.push(n[e])})),i.every((e=>!0===e))},generateSVGFilter:f,generateFeColorMatrix:p,generateFeComponentTransfer:d,generateAnimate:m,addFiltersToDefs:function(e,t=document.querySelector("svg")){Object.keys(e).forEach((t=>{const s=y(e[t]);if(!document.querySelector("svg defs")){const e=document.createElementNS("http://www.w3.org/2000/svg","defs");document.querySelector("svg").insertBefore(e,document.querySelector("svg").firstChild)}document.querySelector("svg defs").appendChild(s)}));const s=t.cloneNode(!0);t.parentNode.replaceChild(s,t)},filterFromDictionary:y,applyFilter:function(e,t){const s=t.cloneNode(!0);s.setAttribute("filter",`url(#${e.id})`),t.parentNode.replaceChild(s,t),document.querySelector(`#${e.id}`).querySelectorAll("animate").forEach((e=>{e.setAttribute("href",`#${e.getAttribute("href").slice(1)}${t.id}`),e.setAttribute("id",`${e.getAttribute("id")}${t.id}`)}))},setSvgTextClass:function(e,t,s="selected"){Array.from(e.children).filter((e=>"svg"==e.tagName)).forEach((e=>{e.querySelectorAll("text").forEach((e=>{e.classList[t](s)}))}))},hexToRGB:function(e){return[g(e.slice(1,3)),g(e.slice(3,5)),g(e.slice(5,7))]},RGBToHSL:function(e,t,s){let n,i,o=Math.max(e,t,s),r=Math.min(e,t,s),c=(o+r)/2;if(o==r)n=i=0;else{var a=o-r;switch(i=c<.5?a/(o+r):a/(2-o-r),o){case e:n=(t-s)/a+(t<s?6:0);break;case t:n=(s-e)/a+2;break;case s:n=(e-t)/a+4}n/=6}return n=Math.round(360*n),i=Math.round(100*i),c=Math.round(100*c),[n,i,c]},HSLToHex:function(e,t,s){let n;if(e/=360,s/=100,0==(t/=100))n=[s,s,s];else{const i=s<.5?s*(1+t):s+t-s*t,o=2*s-i;n=[v(o,i,e+1/3),v(o,i,e),v(o,i,e-1/3)]}return n=n.map((e=>b(e))),`#${n.join("")}`},floatToHexDigit:b,hexDigitToFloat:g};"undefined"!=typeof module&&module.exports?(console.log("cm-toolbox running in node...success!"),module.exports=w):"undefined"!=typeof globalThis?globalThis.CM=w:"undefined"!=typeof window&&(window.CM=w)}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};s.r(e),s.d(e,{Decoder:()=>he,Encoder:()=>ae,PacketType:()=>ce,protocol:()=>re});class t{constructor(e=["all"]){this.devices=e,this.map={},this.init()}}Object.assign(t.prototype,{process:function(e){let[t,s,n]=e.data;if(t>=176&&t<=191){let e=t-176;console.log("channel:",t-175,"cc:",s,"value:",n),this.map[e].cc[s](n)}else if(t>=144&&t<=159){let e=t-144;this.processNote(e,s,n),this.map[e].note[s](n)}else if(t>=128&&t<=143){let e=t-128;"undefined"==n&&(n=0),this.processNote(e,s,0),this.map[e].noteOff[s](0),this.map[e].note[s](0)}},init:function(){for(let e=0;e<16;e++){this.map[e]={},this.map[e].cc=[],this.map[e].note=[],this.map[e].noteOff=[],this.map[e].noteRange={};for(let t=0;t<128;t++)this.map[e].cc[t]=function(){},this.map[e].note[t]=function(){},this.map[e].noteOff[t]=function(){}}},success:function(e){for(let t of e.inputs.values())t.onmidimessage=this.process.bind(this),console.log("MIDI Mapper listening:",t.name,t)},failure:function(){console.log("No MIDI device available")},listen:function(){navigator.requestMIDIAccess().then(this.success.bind(this),this.failure.bind(this))},assign:function(e,t,s,n){if(16==e)for(let e=0;e<16;e++)this.map[e][t][s]=n;else this.map[e][t][s]=n;return this},assignRange:function(e,t,s){"full"!=t&&"all"!=t||(t="0,127"),this.map[e].noteRange[t]=s},getRanges:function(e,t,s){return Object.entries(this.map[e].noteRange).filter((([e,s])=>{let n=e.split(",").map((e=>parseFloat(e)));return t>=n[0]&&t<=n[1]})).map((e=>e[1]))},processRange:function(e,t,s){e.forEach((e=>e(t,s)))},processNote:function(e,t,s){this.processRange(this.getRanges(...arguments),t,s)}});const n=t,i=Object.create(null);i.open="0",i.close="1",i.ping="2",i.pong="3",i.message="4",i.upgrade="5",i.noop="6";const o=Object.create(null);Object.keys(i).forEach((e=>{o[i[e]]=e}));const r={type:"error",data:"parser error"},c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,h=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)},l=({type:e,data:t},s,n)=>{return c&&t instanceof Blob?s?n(t):h(t,n):a&&(t instanceof ArrayBuffer||(o=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?s?n(t):h(new Blob([t]),n):n(i[e]+(t||""));var o},u="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)u["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,p=(e,t)=>{if(f){const s=(e=>{let t,s,n,i,o,r=.75*e.length,c=e.length,a=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);const h=new ArrayBuffer(r),l=new Uint8Array(h);for(t=0;t<c;t+=4)s=u[e.charCodeAt(t)],n=u[e.charCodeAt(t+1)],i=u[e.charCodeAt(t+2)],o=u[e.charCodeAt(t+3)],l[a++]=s<<2|n>>4,l[a++]=(15&n)<<4|i>>2,l[a++]=(3&i)<<6|63&o;return h})(e);return d(s,t)}return{base64:!0,data:e}},d=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,m=(e,t)=>{if("string"!=typeof e)return{type:"message",data:d(e,t)};const s=e.charAt(0);return"b"===s?{type:"message",data:p(e.substring(1),t)}:o[s]?e.length>1?{type:o[s],data:e.substring(1)}:{type:o[s]}:r},y=String.fromCharCode(30);function g(e){if(e)return function(e){for(var t in g.prototype)e[t]=g.prototype[t];return e}(e)}g.prototype.on=g.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},g.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},g.prototype.off=g.prototype.removeListener=g.prototype.removeAllListeners=g.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((s=n[i])===t||s.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},g.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){n=0;for(var i=(s=s.slice(0)).length;n<i;++n)s[n].apply(this,t)}return this},g.prototype.emitReserved=g.prototype.emit,g.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},g.prototype.hasListeners=function(e){return!!this.listeners(e).length};const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function v(e,...t){return t.reduce(((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t)),{})}const w=setTimeout,E=clearTimeout;function k(e,t){t.useNativeTimers?(e.setTimeoutFn=w.bind(b),e.clearTimeoutFn=E.bind(b)):(e.setTimeoutFn=setTimeout.bind(b),e.clearTimeoutFn=clearTimeout.bind(b))}class A extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class O extends g{constructor(e){super(),this.writable=!1,k(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,s){return super.emitReserved("error",new A(e,t,s)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=m(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const C="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),T=64,x={};let j,S=0,_=0;function R(e){let t="";do{t=C[e%T]+t,e=Math.floor(e/T)}while(e>0);return t}function N(){const e=R(+new Date);return e!==j?(S=0,j=e):e+"."+R(S++)}for(;_<T;_++)x[C[_]]=_;function B(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}let F=!1;try{F="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const q=F;function D(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||q))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function L(){}const M=null!=new D({xdomain:!1}).responseType;class P extends g{constructor(e,t){super(),k(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=v(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new D(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=P.requestsCount++,P.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=L,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete P.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function $(){for(let e in P.requests)P.requests.hasOwnProperty(e)&&P.requests[e].abort()}P.requestsCount=0,P.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",$):"function"==typeof addEventListener&&addEventListener("onpagehide"in b?"pagehide":"unload",$,!1));const I="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Y=b.WebSocket||b.MozWebSocket,V="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),U={websocket:class extends O{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=V?{}:v(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=V?new Y(e,t,s):t?new Y(e,t):new Y(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const s=e[t],n=t===e.length-1;l(s,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}n&&I((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||(e.b64=1);const n=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}check(){return!!Y}},polling:class extends O{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=M&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const s=e.split(y),n=[];for(let e=0;e<s.length;e++){const i=m(s[e],t);if(n.push(i),"error"===i.type)break}return n})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const s=e.length,n=new Array(s);let i=0;e.forEach(((e,o)=>{l(e,!1,(e=>{n[o]=e,++i===s&&t(n.join(y))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const n=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new P(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},H=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,X=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function z(e){const t=e,s=e.indexOf("["),n=e.indexOf("]");-1!=s&&-1!=n&&(e=e.substring(0,s)+e.substring(s,n).replace(/:/g,";")+e.substring(n,e.length));let i=H.exec(e||""),o={},r=14;for(;r--;)o[X[r]]=i[r]||"";return-1!=s&&-1!=n&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){const s=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),s}(0,o.path),o.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(s[t]=n)})),s}(0,o.query),o}class G extends g{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=z(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=z(t.host).host),k(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},s=e.split("&");for(let e=0,n=s.length;e<n;e++){let n=s[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new U[e](s)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),s=!1;G.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){s||(s=!0,h(),t.close(),t=null)}const o=e=>{const s=new Error("probe error: "+e);s.transport=t.name,i(),this.emitReserved("upgradeError",s)};function r(){o("transport closed")}function c(){o("socket closed")}function a(e){t&&e.name!==t.name&&i()}const h=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",r),this.off("close",c),this.off("upgrading",a)};t.once("open",n),t.once("error",o),t.once("close",r),this.once("close",c),this.once("upgrading",a),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let s=0;s<this.writeBuffer.length;s++){const n=this.writeBuffer[s].data;if(n&&(e+="string"==typeof(t=n)?function(e){let t=0,s=0;for(let n=0,i=e.length;n<i;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}(t):Math.ceil(1.33*(t.byteLength||t.size))),s>0&&e>this.maxPayload)return this.writeBuffer.slice(0,s);e+=2}var t;return this.writeBuffer}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const i={type:e,data:t,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():e()})):this.upgrading?s():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const n=e.length;for(;s<n;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}G.protocol=4,G.protocol;const K="function"==typeof ArrayBuffer,W=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,J=Object.prototype.toString,Q="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===J.call(Blob),Z="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===J.call(File);function ee(e){return K&&(e instanceof ArrayBuffer||W(e))||Q&&e instanceof Blob||Z&&e instanceof File}function te(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(te(e[t]))return!0;return!1}if(ee(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return te(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&te(e[t]))return!0;return!1}function se(e){const t=[],s=e.data,n=e;return n.data=ne(s,t),n.attachments=t.length,{packet:n,buffers:t}}function ne(e,t){if(!e)return e;if(ee(e)){const s={_placeholder:!0,num:t.length};return t.push(e),s}if(Array.isArray(e)){const s=new Array(e.length);for(let n=0;n<e.length;n++)s[n]=ne(e[n],t);return s}if("object"==typeof e&&!(e instanceof Date)){const s={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(s[n]=ne(e[n],t));return s}return e}function ie(e,t){return e.data=oe(e.data,t),delete e.attachments,e}function oe(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let s=0;s<e.length;s++)e[s]=oe(e[s],t);else if("object"==typeof e)for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=oe(e[s],t));return e}const re=5;var ce;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ce||(ce={}));class ae{constructor(e){this.replacer=e}encode(e){return e.type!==ce.EVENT&&e.type!==ce.ACK||!te(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ce.EVENT?ce.BINARY_EVENT:ce.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ce.BINARY_EVENT&&e.type!==ce.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=se(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}class he extends g{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===ce.BINARY_EVENT;s||t.type===ce.BINARY_ACK?(t.type=s?ce.EVENT:ce.ACK,this.reconstructor=new le(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ee(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===ce[s.type])throw new Error("unknown packet type "+s.type);if(s.type===ce.BINARY_EVENT||s.type===ce.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(i)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);s.nsp=e.substring(n,t)}else s.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!he.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case ce.CONNECT:return"object"==typeof t;case ce.DISCONNECT:return void 0===t;case ce.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case ce.EVENT:case ce.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case ce.ACK:case ce.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class le{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ie(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ue(e,t,s){return e.on(t,s),function(){e.off(t,s)}}const fe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class pe extends g{constructor(e,t,s){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ue(e,"open",this.onopen.bind(this)),ue(e,"packet",this.onpacket.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(fe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const s={type:ce.EVENT,data:t,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),s.id=e}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){const s=this.flags.timeout;if(void 0===s)return void(this.acks[e]=t);const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),s);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:ce.CONNECT,data:e})})):this.packet({type:ce.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ce.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ce.EVENT:case ce.BINARY_EVENT:this.onevent(e);break;case ce.ACK:case ce.BINARY_ACK:this.onack(e);break;case ce.DISCONNECT:this.ondisconnect();break;case ce.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let s=!1;return function(...n){s||(s=!0,t.packet({type:ce.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ce.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}function de(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}de.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-s:e+s}return 0|Math.min(e,this.max)},de.prototype.reset=function(){this.attempts=0},de.prototype.setMin=function(e){this.ms=e},de.prototype.setMax=function(e){this.max=e},de.prototype.setJitter=function(e){this.jitter=e};class me extends g{constructor(t,s){var n;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(s=t,t=void 0),(s=s||{}).path=s.path||"/socket.io",this.opts=s,k(this,s),this.reconnection(!1!==s.reconnection),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=s.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new de({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==s.timeout?2e4:s.timeout),this._readyState="closed",this.uri=t;const i=s.parser||e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==s.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new G(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const n=ue(t,"open",(function(){s.onopen(),e&&e()})),i=ue(t,"error",(t=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",t),e?e(t):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&n();const s=this.setTimeoutFn((()=>{n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ue(e,"ping",this.onping.bind(this)),ue(e,"data",this.ondata.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this)),ue(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){I((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s||(s=new pe(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ye={};function ge(e,t){"object"==typeof e&&(t=e,e=void 0);const s=function(e,t="",s){let n=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),n=z(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(s&&s.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=s.source,i=s.id,o=s.path,r=ye[i]&&o in ye[i].nsps;let c;return t.forceNew||t["force new connection"]||!1===t.multiplex||r?c=new me(n,t):(ye[i]||(ye[i]=new me(n,t)),c=ye[i]),s.query&&!t.query&&(t.query=s.queryKey),c.socket(s.path,t)}Object.assign(ge,{Manager:me,Socket:pe,io:ge,connect:ge});const be="https://www.btb.software/";class ve{constructor(){console.log("url",be),this.socket=ge.connect(be,{transports:["websocket"]}),this.out={note:this.emitNote.bind(this),cc:this.emitCC.bind(this)},this.in={note:this.onNote,cc:this.onCC}}setPath(e="default"){this.path=e}emitMidi(e,t){this.socket.emit("midi",t)}emitNote(e,t,s){let n={message:[e-=e>=144?144:0,t,s],type:"note",ramp:0,path:this.path};this.socket.emit("midi",n)}emitCC(e,t,s){let n={message:[e-=e>=144?144:0,t,s],type:"cc",ramp:0,path:this.path};this.socket.emit("midi",n)}listen(){this.socket.on("midi",(e=>{Object.keys(this.in).includes(e.type)?this.in[e.type](e.message,e.ramp):console.log("unknown type of midi message",e.type)})),Object.values(this.in).forEach(((e,t)=>{}))}onNote(e,t){console.log("onNote",e,t)}onCC(e,t){}}s(876),"undefined"!=typeof window&&(console.log("socket-mapper running in browser..."),window.SocketMapper=ve);const we=ve;var Ee=function(e,t){Object.entries(t).forEach((t=>{let[s,n]=t;switch(s){case"custom":Object.entries(n).forEach((t=>e.setAttribute(...t)));break;case"style":Object.entries(n).forEach((t=>e.style[t[0]]=t[1]));break;case"dataset":Object.entries(n).forEach((t=>e.dataset[t[0]]=t[1]));break;default:e[s]=n}}))},ke=ke||"http://www.w3.org/2000/svg",Ae=function(e,t,s=document){let n=s.createElementNS(ke,e);return Ee(n,t),n},Oe=function(e,t,s,n={},i){i||"undefined"==typeof document||(i=document);let o={custom:{attributeName:"fill",begin:"indefinite",repeatCount:"1",dur:"1s",fill:"freeze",keyTimes:"0; 1",values:"red; blue"}};"object"==typeof arguments[0]&&(Object.assign(o.custom,arguments[0].custom),"dur"in o.custom||(o.custom.dur=`${arguments[0].duration}s`),t=arguments[0].events,s=arguments[0].duration,arguments.length>1&&(i=arguments[1]));let r="",c="";if(!Array.isArray(t)){let e=[];Object.keys(t).forEach((s=>{e.push([s,t[s]])})),(t=e).sort(((e,t)=>e[0]-t[0]))}t.forEach((([e,s],n)=>{parseFloat(e)%1==0&&(e+=".00");let i=n<Object.keys(t).length-1?"; ":"";c+=`${e}${i}`,r+=`${s}${i}`})),o.custom.values=r,o.custom.keyTimes=c;let a=Ae("translate"==e?"animateTransform":"animate",o,i);return a=Object.assign(a,n),a},Ce=function(e,t,s,n=!1){return(e=n?Math.floor(e):e)>s?s:e<t?t:e},Te=function(e,t,s){s||"undefined"==typeof document||(s=document);let n=s.createElement(e);return Ee(n,t),n},xe=function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toFrequency()},je=function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toFrequency()};function Se(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","filter");return s.setAttribute("id",e),s.setAttribute("filterUnits",t),s}function _e(e,t,s){const n=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");return n.setAttribute("id",e),n.setAttribute("type",t),n.setAttribute("values",s),n}function Re(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");return t.setAttribute("id",e),t}function Ne(e){const t=document.createElementNS("http://www.w3.org/2000/svg","animate");return Object.keys(e).forEach((s=>{t.setAttribute(s,e[s])})),t}function Be(e){const t=Se(e.id,e.filterUnits),s=Re("feComponentTransfer1");return t.appendChild(s),Object.keys(e.components).forEach((s=>{const n=e.components[s],i=_e(n.id,n.type,n.values);t.appendChild(i)})),Object.keys(e.animations).length>0&&Object.keys(e.animations).forEach((s=>{const n=Ne(e.animations[s]);t.appendChild(n)})),t}console.log("running cm-toolbox");var Fe={CSSToggle:class{constructor(e,t=!1,s=.1,n=.3,i="hc--light",o="fill"){this.element=e,this.on=t,this.attack=s,this.release=n,this.effectClass=i}toggle(){this.on=!this.on;let{element:e,on:t,attack:s,release:n,effectClass:i}=this;e.style.transition=`fill ${t?s:n}s ease`,e.classList[t?"add":"remove"](i)}trigger(e,t=!0){this.on=e;let{element:s,attack:n,release:i,effectClass:o}=this;s.style.transition=`fill ${e?n:i}s ease`,s.classList[e?"add":"remove"](o)}set attack(e){this._attack=e}set release(e){this._release=e}},addAnimation:function(e,t,s,n,i={},o){o||"undefined"==typeof document||(o=document);let r,c="object"==typeof e?e:o.getElementById(e);if("object"==typeof arguments[1]){let e={custom:{}};Object.assign(e,arguments[1]),arguments.length>2&&(o=arguments[2]),"id"in e.custom||(e.custom.id=`${c.id}_${t}`),r=Oe(e,o)}else"id"in i||(i.id=`${c.id}_${t}`),r=Oe(t,s,n,i,o);return c.appendChild(r),r},constrain:Ce,create:Te,createFilter:function(e,t){let s={filter:Ae("filter",{id:e,custom:{filterUnits:"objectBoundingBox",x:"0",y:"0",width:"100%",height:"100%"}}),animation:{},update:{}};return"string"==typeof t&&(t=[t]),t.forEach((n=>{s[n]=Ae("feColorMatrix",{id:`${e}_${n}`,custom:{type:t,in:"SourceGraphic",values:0}}),s.filter.appendChild(s[n]),s.animation[n]=Oe("values",[[0,0],[1,1]],.1),s[n].appendChild(s.animation[n]),s.update[n]=function(e,t="unspecified",i="unspecified"){"unspecified"==i&&(i=s[n].values.animVal.getItem("value").value),"unspecified"!=t&&s.animation[n].setAttribute("dur",`${t}s`),s.animation[n].setAttribute("values",`${i};${e}`),console.log(s.animation[n]),s.animation[n].beginElement()}})),s},createAnimation:Oe,createNS:Ae,ftos:function(e,t=0){return sym=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toNote()},getTranslate:e=>{const t=getComputedStyle(e).transform,{e:s,f:n}="none"==t?{e:0,f:0}:new DOMMatrix(t);return{x:s,y:n}},hexToInt:function(e){let t=[0,0];for(let s=0;s<2;s++)t[s]=e.charCodeAt(s),t[s]-=t[s]>=65?55:48;return t[0]*=16,t[0]+t[1]},interpolate:function(e,t,s,n=!1){let i=(1-s)*e+s*t;return i=n?Math.floor(i):i,i},intToHex:function(e){let t=[0,0];t[0]=Math.floor(e/16),t[1]=e%16;for(let e in t)t[e]=t[e]>9?String.fromCharCode(t[e]+55):t[e];return`${t[0]}${t[1]}`},map:function(e,t,s,n,i,o=!1,r=!1){return e-=t,e*=i-n,e/=s-t,e+=t,e=r?Math.floor(e):e,o?Ce(e,n,i):e},mtof:xe,mtos:function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toNote()},populate:function(e,t,s=!1,n="option"){t.forEach((t=>{e.appendChild(Te(n,{value:t,innerHTML:t})),0!=s&&(e.value=s)}))},rot:function(e,t){let s=[e.slice(t),e.slice(0,t)];return s[0].concat(s[1])},set:Ee,setInTree:function(e=[],t=0,s=this){"string"==typeof e&&(e=e.split("_"));var n=s;e.forEach(((e,t,s)=>{t<s.length-1&&(n=n[e])})),console.log(n,t),n[e[e.length-1]]=t},setNS:function(e,t){Object.entries(t).forEach((t=>{let[s,n]=t;switch(s){case"custom":Object.entries(n).forEach((t=>{e.setAttributeNS(xmlns,...t)}));break;case"style":Object.entries(n).forEach((t=>e.style[t[0]]=t[1]));break;default:e[s]=n}}))},stom:function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toMidi()},stof:je,transposeForPlayer:function(e,t){return"string"==typeof e?e=je(e):"number"==typeof e&&(e=xe(e)),"string"==typeof t?t=je(t):"number"==typeof t&&(t=xe(t)),e/t},v:function(e){return Tone.gainToDb(e)},within:function(e=0,t=0,s={left:0,right:0,top:0,bottom:0}){let n={left:e>=s.left,right:e<=s.right,top:t>=s.top,bottom:t<=s.bottom},i=[];return Object.keys(s).forEach((e=>{e in n&&i.push(n[e])})),i.every((e=>!0===e))},generateSVGFilter:Se,generateFeColorMatrix:_e,generateFeComponentTransfer:Re,generateAnimate:Ne,addFiltersToDefs:function(e,t=document.querySelector("svg")){Object.keys(e).forEach((t=>{const s=Be(e[t]);if(!document.querySelector("svg defs")){const e=document.createElementNS("http://www.w3.org/2000/svg","defs");document.querySelector("svg").insertBefore(e,document.querySelector("svg").firstChild)}document.querySelector("svg defs").appendChild(s)}));const s=t.cloneNode(!0);t.parentNode.replaceChild(s,t)},filterFromDictionary:Be,applyFilter:function(e,t){const s=t.cloneNode(!0);s.setAttribute("filter",`url(#${e.id})`),t.parentNode.replaceChild(s,t),document.querySelector(`#${e.id}`).querySelectorAll("animate").forEach((e=>{e.setAttribute("href",`#${e.getAttribute("href").slice(1)}${t.id}`),e.setAttribute("id",`${e.getAttribute("id")}${t.id}`)}))}};"undefined"!=typeof module&&module.exports?(console.log("cm-toolbox running in node...success!"),module.exports=Fe):"undefined"!=typeof globalThis?globalThis.CM=Fe:"undefined"!=typeof window&&(window.CM=Fe);class qe{constructor(e={},t="serial_accelerometer",s=115200){this.port=null,this.baudRate=s,this.actions=e}}Object.assign(qe.prototype,{connect:async function(){try{this.port=await navigator.serial.requestPort(),await this.port.open({baudRate:this.baudRate}),this.encoder=new TextEncoderStream,this.encoder.readable.pipeTo(this.port.writable),this.writer=this.encoder.writable.getWriter(),this.listen()}catch(e){console.error(e)}},listen:async function(e=this.actions){try{for(this.decoder=new TextDecoderStream,this.port.readable.pipeTo(this.decoder.writable),this.reader=this.decoder.readable.getReader(),this.messageBuffer="";;){const{value:e,done:t}=await this.reader.read();if(t){this.reader.releaseLock();break}e&&(this.messageBuffer+=e,this.messageBuffer.includes("\r\n")&&(Object.entries(this.actions).forEach((([e,t])=>{if(this.messageBuffer.includes(e)){let s=this.messageBuffer.replace("\r\n","").replace(e,"").split(" ").map((e=>parseInt(e))).filter((e=>"number"==typeof e&&!isNaN(e)));document.dispatchEvent(new CustomEvent(t,{detail:{array:s},bubbles:!0,cancelable:!0,composed:!1}))}})),this.messageBuffer=""))}}catch(e){console.error(e)}},write:async function(e){try{await this.writer.write(e)}catch(e){console.error(e)}},writeQueue:async function(e=[]){try{for(let t of e)await this.writer.write(t)}catch(e){return console.error(e),!1}return!0},assign:function(e={}){Object.assign(this.actions,e)},assignRoute:function(e={}){this.assign(e)}});const De=qe;var Le=s(441);const Me={newton_12:{names:["Red","OrangeRed","Orange","Gold","Yellow","YellowGreen","Green","LightSeaGreen","Blue","BlueViolet","Indigo","Purple"],description:"Color wheel with added accidentals, based on Newton's system.",author:"Charles Matthews"},daze:{names:["Orange","Pale Orange","Magenta","Greenish Grey","Sea green","Yellow","Rust","Red","Lilac","Purple","Pale Green","Deep pool blue"],namesHTML:["Orange","NavajoWhite","Magenta","PaleGreen","Aqua","Yellow","Sienna","Red","Orchid","Purple","LimeGreen","DeepSkyBlue"],hex:["#ff9933","#ffcc99","#f85af8","#c3fcc8","#0cffff","#ffff03","#e0b5a2","#ff0101","#c37596","#cc66ff","#33cc33","#0783dc"],led:["#FFA500","#FFE4C4","#FF00FF","#18FB18","#00FFFF","#FFFF00","#A03211","#FF0000","#DA70D6","#800080","#00CD00","#00BFFF"],description:"Colour Pitch Assembly by Joel Daze.  Please reference this project if used.",author:"Joel Daze"},purples:{names:["Purple","Indigo","DarkViolet","BlueViolet","MediumSlateBlue","SlateBlue","MediumOrchid","Violet","Plum","Orchid","MediumPurple","DarkOrchid"],description:"A set of purples",author:"Charles Matthews"}};class Pe{constructor(){Object.assign(this,{pitch:-1,velocity:0,active:!1})}on(e,t){this.active=!0,Object.assign(this,{pitch:e,velocity:t})}off(){this.active=!1,Object.assign(this,{pitch:-1,velocity:0})}}function $e(){let{voices:e}=window.colours,t=e.voices;document.querySelectorAll(".testBar").forEach(((e,s)=>{e.style.backgroundColor=t[s].active?noteColours.daze.hex[t[s].pitch%12]:"black"}))}const Ie=function(){let{arduino:e,socket:t,voices:s}=window.colours;e.connect(),t.in.cc=e=>{let[t,n,i]=e;if(64==n)if(127==i)colours.hold=!0;else if(colours.hold&&0==i){s.flush(),colours.hold=!1,$e(),s.voices.map((e=>e.pitch)).forEach(((e,t)=>{colours.lights[Object.keys(colours.lights)[t]].write=[0,0,0]})),processAll()}},t.in.note=e=>{let[t,n,i]=e;if(!i&&colours.hold)return;let o=s.update(n,i,!1);var r;colours.intensities[(r=o,Object.keys(colours.lights)[r])]=i,colours.voices.voices.forEach(((e,t)=>{writeNoteColour(e.pitch,t)})),$e()},t.listen()},Ye=function(e,t=0){let{always_on:s}=colours;t=parseInt(t)+1;let n=e.map(((e,s)=>`${s+t}:${e}`)).join("\n");return s&&(n+=`\n${t-1}:255\n`),n};function Ve(){let{socket:e}=colours,t=(new Tone.PolySynth).toMaster();Tone.start(),console.log("init"),e.listen(),e.in.note=e=>{let[s,n,i]=e;t[e[2]?"triggerAttack":"triggerRelease"](Tone.Frequency(n,"midi").toNote(),void 0,i/127)}}function Ue(e,t){let s=e[t];return"#"==s[0]&&(s=s.slice(1)),3==s.length&&(s=s.split("").map((e=>e+e)).join("")),s=s.match(/.{2}/g).map((e=>parseInt(e,16))),s}function He(e=0,t=0){let s,n,{arduino:i,initFlag:o,lights:r}=colours;if(-1==e){if(colours.use_decay)return;s=[0,0,0]}else{s=Ue(Me.daze.led,e%12);let t=colours.voices.voices.findIndex((t=>t.pitch==e));n=colours.voices.voices[t].velocity,console.log("intensity",n),s=s.map((e=>Math.floor(e*n/127)))}console.log("colour",s),colours.lights[Object.keys(r)[t]]=s,Xe()}function Xe(){let e,{queue:t,arduino:s,lights:n,audio:i,always_write:o}=colours;i.meter&&(e=1*Tone.dbToGain(i.meter.getLevel()),e>1&&(e=1)),Object.entries(n).forEach((([e,t])=>{t.join("")==colours.lights_last[e].join("")||(colours.queue.push(Ye(t,e)),colours.lights_last[e]=t)})),function(){let{arduino:e,initFlag:t,intensities:s}=colours;Object.entries(s).forEach((([e,t])=>{t==colours.intensities_last[e]||(colours.queue.push(`${e}:${t}\n`),colours.intensities_last[e]=t)}))}(),o&&Ke()}function ze(e){return Object.keys(colours.lights)[e]}function Ge(){let{arduino:e,initFlag:t,lights:s,intensities:n,voices:i}=colours;i.voices.forEach(((e,t)=>{console.log(e.active,n[ze(t)]),!e.active&&n[ze(t)]&&(console.log(n[ze(t)]),colours.intensities[ze(t)]-=1,He(e.pitch,t)),console.log("intensities",n)}))}function Ke(){colours.use_decay&&Ge();let{queue:e,arduino:t}=colours;e.length&&(t.writeQueue(e),colours.queue=[])}window.MidiMapper=n,window.colours={midi:new n,socket:new we,arduino:new De,voices:new class{constructor(e=4,t=!0){this.stealing=t,this.voices=[];for(let t=0;t<e;t++)this.voices.push(new Pe)}update(e,t,s=!1){let n=this.voices.filter((e=>e.active)),i=this.voices.find((t=>t.pitch==e));return t?(i?i.on(e,t):n.length==this.voices.length?this.stealing&&(i=this.steal(e,t)):(i=this.voices.find((e=>!e.active)),i.on(e,t)),s?this.voices:this.voices.indexOf(i)):(i&&i.off(),!!s&&this.voices)}steal(e,t){return this.voices[this.voices.length-1].on(e,t),this.voices[this.voices.length-1]}getVoice(e){return this.voices[e]}getVoices(){return this.voices}getActiveVoices(){return this.voices.filter((e=>e.active))}getInactiveVoices(){return this.voices.filter((e=>!e.active))}getActiveVoiceCount(){return this.voices.filter((e=>e.active)).length}flush(){this.voices.forEach((e=>e.off()))}}(4),touch:new Le,initFlag:!1,polyphony:4,lights:{1:[0,0,0],11:[0,0,0],22:[0,0,0],33:[0,0,0]},lights_last:{1:[0,0,0],11:[0,0,0],22:[0,0,0],33:[0,0,0]},intensities:{1:0,11:0,22:0,33:0},intensities_last:{1:0,11:0,22:0,33:0},decays:{1:0,11:0,22:0,33:0},always_on:!0,always_write:!0,use_velocity:!0,use_decay:!1,queue:[],audio:{},multiplier:1,hold:!1},document.querySelectorAll("#socketInit").forEach((e=>e.addEventListener("click",Ve))),document.querySelectorAll("#dmxInit").forEach((e=>e.addEventListener("click",Ie))),document.querySelectorAll("#flush").forEach((e=>e.addEventListener("click",colours.voices.flush))),document.querySelectorAll("#hold").forEach((e=>{e.addEventListener("input",(function(){!function(e){colours.hold=e}(this.checked)}))})),Object.assign(window,{getColour:Ue,formatColour:Ye,writeNoteColour:He,start:function(){let{midi:e,socket:t,voices:s}=window.colours;Math.random().toString(36).slice(2),e.map[0].noteRange["0,127"]=function(e,n){let i=s.update(e,n,!0);document.querySelectorAll(".testBar").forEach(((e,t)=>{e.style.backgroundColor=i[t].active?noteColours.daze.hex[i[t].pitch%12]:"black"})),t.emitNote(0,e,n)},e.map[0].cc[64]=function(e){t.emitCC(0,64,e)},e.listen()},noteColours:Me,processQueue:function(){let{queue:e,arduino:t}=window.colours;e.length&&(t.writeQueue(e),e=[])},processAll:Xe,autoWrite:function(e=!0,t=30){colours.alwayws_write=e,e?colours.interval=setInterval(Ke,t):clearInterval(colours.interval)},writeQueue:Ke,initAudio:function(){colours.audio.mic=new Tone.UserMedia,colours.audio.meter=new Tone.Meter,colours.audio.mic.connect(colours.audio.meter),colours.audio.mic.open().then((()=>{}))},update:Ge})})()})();