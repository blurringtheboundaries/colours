(()=>{var e={441:(e,t,n)=>{const s=function(){this.listen()};(s.prototype={listeners:["mousemove","mousedown","mouseup","mouseleave","touchstart","touchmove","touchend","touchcancel"],eventQueue:[],depth:1,preventDefault:!0,mono:!0,buffer:{},rejectedBuffer:[],touchStartTime:0,target:document,debounce:!0,customEvent:{enabled:!0,name:"touch-pickup"},classes:{allow:"allowDefault",prevent:"preventDefault"},actions:{default:{touch:(e,t,n)=>{},hover:(e,t,n)=>{},drag:(e,t,n)=>{},leave:(e,t,n)=>{},enter:(e,t,n)=>{},start:(e,t,n)=>{},end:(e,t,n)=>{}},".allowDefault":{start:function(){window.currentPreventDefault=!1},hover:function(){window.currentPreventDefault=!1},move:function(){window.currentPreventDefault=!1},drag:function(){window.currentPreventDefault=!1},leave:function(){window.currentPreventDefault=!1},enter:function(){window.currentPreventDefault=!1},end:function(){window.currentPreventDefault=!1}},".preventDefault":{touch:function(e,t,n){t.preventDefault()},hover:function(e,t,n){t.preventDefault()},move:function(){window.currentPreventDefault=!1},drag:function(e,t,n){t.preventDefault()},leave:function(e,t,n){t.preventDefault()},enter:function(e,t,n){t.preventDefault()},end:function(){window.currentPreventDefault=!1}}}}).constructor=s,["getListOfElements","matchActions","handleEvent","listen","unlisten","processElement","setDefaultAction","setAction","setActionsAsDictionary","assignAllowDefault","addStyles"].forEach((e=>s.prototype[e]=n(905)(`./${e}`))),e.exports=s},762:e=>{e.exports=function(){return this.stylesheet=document.createElement("style"),this.stylesheet.innerHTML=`.${this.classes.detect}{\n        pointer-events:auto;\n        touch-action:none;\n    }\n        \n.\n    ${this.classes.ignore}{\n        pointer-events:none;\n        touch-action:none;\n    }`,document.querySelector("head").appendChild(this.stylesheet),this}},562:e=>{e.exports=function(e={},t="add"){return e.querySelectorAll("*").forEach((e=>{e.classList[t](this.classes.allow)})),this}},841:e=>{e.exports=function(e,t,n=document){let s=n.elementsFromPoint(e,t);return s=Array.from(s).filter((e=>this.matchActions(e))),s=s.slice(0,this.depth),s}},378:(e,t,n)=>{const s=n(797).j8;e.exports=function(e){this.mono=!1,window.currentPreventDefault=this.preventDefault;let t=e;e.type.includes("mouse")&&("mousedown"==e.type?e={type:"touchstart",changedTouches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]}:"mousemove"==e.type&&e.buttons>0?e={type:"touchmove",touches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]}:"mouseup"==e.type&&(e={type:"touchend",changedTouches:[{identifier:"mouse",clientX:e.clientX,clientY:e.clientY,preventDefault:function(e){e.preventDefault()}.bind(e)}]})),"touchstart"==e.type?(0==Object.keys(this.buffer).length&&(this.touchStartTime=Date.now()),Array.from(e.changedTouches).forEach((t=>{this.buffer[t.identifier]={elements:{},history:{}},this.getListOfElements(t.clientX,t.clientY).slice(0,this.depth).forEach(((n,s)=>{this.processElement(n,t.identifier,s,"start",e,t)}))}))):"touchmove"==e.type?Array.from(e.touches).forEach((t=>{let n=[];this.getListOfElements(t.clientX,t.clientY).slice(0,this.depth).forEach(((s,i)=>{this.processElement(s,t.identifier,i,"move",e,t)&&n.push(s.id)})),Object.keys(this.buffer).length>0&&Object.entries(this.buffer[t.identifier].elements).forEach((([s,i],o)=>{n.includes(s)||(this.buffer[t.identifier].history[s]=this.buffer[t.identifier].elements[s],this.processElement(i.query,t.identifier,o,"leave",e,t,s),delete this.buffer[t.identifier].elements[s])}))})):"touchend"==e.type&&Array.from(e.changedTouches).forEach((t=>{Object.entries(this.buffer[t.identifier].elements).forEach((([n,s],i)=>{this.processElement(s.query,t.identifier,i,"end",e,t,n)})),delete this.buffer[t.identifier]})),this.eventQueue.forEach((([e,t,n,i,o])=>{"function"==typeof this.actions[e][t]&&this.actions[e][t](n,i,o),this.customEvent.enabled&&s(this.customEvent.name,o)})),this.eventQueue=[],window.currentPreventDefault&&t.preventDefault()}},447:e=>{e.exports=function(e=document){for(let t of this.listeners)e.addEventListener(t,this,!1);return console.log(`multitouch mapper listening on ${e==document?"document":e.id}...`),this}},796:e=>{e.exports=function(e){let t=!1;return Object.keys(this.actions).forEach(((n,s)=>{"object"==typeof e?e.matches(n)&&(t=!0):"string"==typeof e&&e==n&&(t=!0)})),t}},384:e=>{e.exports=function(e,t,n,s,i,o,r){let c=!1;return Object.entries(this.actions).forEach((([n,a],h)=>{let l=!1;if("object"==typeof e?(l=e.matches(n),r=e.id):"string"==typeof e&&(l=e==n,e=document.querySelector(`#${r}`)),l){let a=this.buffer[t].elements;const h=e.getBoundingClientRect();Object.keys(a).includes(r)?"move"==s?(a[r].type="move",a[r].query=n,a[r].delta.x=o.clientX-a[r].x,a[r].delta.y=o.clientY-a[r].y,a[r].path.x.push(o.clientX),a[r].path.y.push(o.clientY),a[r].x=o.clientX,a[r].y=o.clientY,a[r].relative.x=o.clientX-h.left,a[r].relative.y=h.bottom-o.clientY,a[r].distance.x=o.clientX-a[r].origin.x,a[r].distance.y=o.clientY-a[r].origin.y,a[r].iterations+=1):"end"==s?a[r].type="end":"leave"==s&&(a[r].type="leave"):a[r]={id:r,element:e,time:Date.now(),type:"start"==s?"start":"enter",x:o.clientX,y:o.clientY,query:n,iterations:0,rect:{original:h,current:h},origin:{x:o.clientX,y:o.clientY},relative:{x:o.clientX-h.left,y:h.bottom-o.clientY,range:{x:h.width,y:h.height}},distance:{x:0,y:0},path:{x:[o.clientX],y:[o.clientY]},delta:{x:0,y:0}},this.eventQueue.push([n,a[r].type,e,i,a[r]]),c=!0}})),c}},807:e=>{e.exports=function(e,t,n){return Object.keys(this.actions).includes(e)||(this.actions[e]={}),Object.assign(this.actions[e],{start:function(e,t,n){},enter:function(e,t,n){},move:function(e,t,n){},leave:function(e,t,n){},end:function(e,t,n){}}),"object"==typeof t?this.setActionsAsDictionary(e,t):"string"==typeof t&&("all"==t?Object.keys(this.actions[e]).forEach((t=>{this.actions[e][t]=n.bind(this)})):this.actions[e][t]=n.bind(this)),this}},21:e=>{e.exports=function(e,t={}){return Object.entries(t).forEach((([t,n])=>{this.actions[e][t]=n})),this}},838:e=>{e.exports=function(e){return this.setAction("default","all",e),this}},411:e=>{e.exports=function(e=document){for(let t of this.listeners)e.removeEventListener(t,this);return console.log(`removed multitouch mapper listener on ${e==document?"document":e.id}...`),this}},905:(e,t,n)=>{var s={"./addStyles":762,"./addStyles.js":762,"./assignAllowDefault":562,"./assignAllowDefault.js":562,"./getListOfElements":841,"./getListOfElements.js":841,"./handleEvent":378,"./handleEvent.js":378,"./listen":447,"./listen.js":447,"./matchActions":796,"./matchActions.js":796,"./processElement":384,"./processElement.js":384,"./setAction":807,"./setAction.js":807,"./setActionsAsDictionary":21,"./setActionsAsDictionary.js":21,"./setDefaultAction":838,"./setDefaultAction.js":838,"./unlisten":411,"./unlisten.js":411};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=o,e.exports=i,i.id=905},876:(e,t,n)=>{class s{constructor(e=["all"]){this.devices=e,this.map={},this.init()}}["process","init","success","failure","listen","assign","assignRange","getRanges","processRange","processNote"].forEach((e=>{s.prototype[e]=n(492)(`./${e}`)})),e.exports=s},720:e=>{e.exports=function(e,t,n,s){if(16==e)for(let e=0;e<16;e++)this.map[e][t][n]=s;else this.map[e][t][n]=s}},583:()=>{},444:e=>{e.exports=function(e,t,n){"full"!=t&&"all"!=t||(t="0,127"),this.map[e].noteRange[t]=n}},691:e=>{e.exports=function(){console.log("No MIDI device available")}},254:e=>{e.exports=function(e,t,n){return Object.entries(this.map[e].noteRange).filter((([e,n])=>{let s=e.split(",").map((e=>parseFloat(e)));return t>=s[0]&&t<=s[1]})).map((e=>e[1]))}},91:e=>{e.exports=function(){for(let e=0;e<16;e++){this.map[e]={},this.map[e].cc=[],this.map[e].note=[],this.map[e].noteOff=[],this.map[e].noteRange={};for(let t=0;t<128;t++)this.map[e].cc[t]=function(){},this.map[e].note[t]=function(){},this.map[e].noteOff[t]=function(){}}}},919:e=>{e.exports=function(){navigator.requestMIDIAccess().then(this.success.bind(this),this.failure.bind(this))}},250:e=>{e.exports=function(e){let[t,n,s]=e.data;if(t>=176&&t<=191){let e=t-176;console.log("channel:",t-175,"cc:",n,"value:",s),this.map[e].cc[n](s)}else if(t>=144&&t<=159){let e=t-144;this.processNote(e,n,s),this.map[e].note[n](s)}else if(t>=128&&t<=143){let e=t-128;"undefined"==s&&(s=0),this.map[e].noteOff[n](0)}}},371:e=>{e.exports=function(e,t,n){this.processRange(this.getRanges(...arguments),t,n)}},335:e=>{e.exports=function(e,t,n){e.forEach((e=>e(t,n)))}},904:e=>{e.exports=function(e){for(let t of e.inputs.values())t.onmidimessage=this.process.bind(this),console.log("MIDI Mapper listening:",t.name,t)}},492:(e,t,n)=>{var s={"./assign":720,"./assign.js":720,"./assignCC":583,"./assignCC.js":583,"./assignRange":444,"./assignRange.js":444,"./failure":691,"./failure.js":691,"./getRanges":254,"./getRanges.js":254,"./init":91,"./init.js":91,"./listen":919,"./listen.js":919,"./process":250,"./process.js":250,"./processNote":371,"./processNote.js":371,"./processRange":335,"./processRange.js":335,"./success":904,"./success.js":904};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=o,e.exports=i,i.id=492},797:(e,t,n)=>{"use strict";n.d(t,{j8:()=>h});var s=function(e,t){Object.entries(t).forEach((t=>{let[n,s]=t;switch(n){case"custom":Object.entries(s).forEach((t=>e.setAttribute(...t)));break;case"style":Object.entries(s).forEach((t=>e.style[t[0]]=t[1]));break;case"dataset":Object.entries(s).forEach((t=>e.dataset[t[0]]=t[1]));break;default:e[n]=s}}))},i=i||"http://www.w3.org/2000/svg",o=function(e,t,n=document){let o=n.createElementNS(i,e);return s(o,t),o},r=function(e,t,n,s={},i){i||"undefined"==typeof document||(i=document);let r={custom:{attributeName:"fill",begin:"indefinite",repeatCount:"1",dur:"1s",fill:"freeze",keyTimes:"0; 1",values:"red; blue"}};"object"==typeof arguments[0]&&(Object.assign(r.custom,arguments[0].custom),"dur"in r.custom||(r.custom.dur=`${arguments[0].duration}s`),t=arguments[0].events,n=arguments[0].duration,arguments.length>1&&(i=arguments[1]));let c="",a="";if(!Array.isArray(t)){let e=[];Object.keys(t).forEach((n=>{e.push([n,t[n]])})),(t=e).sort(((e,t)=>e[0]-t[0]))}t.forEach((([e,n],s)=>{parseFloat(e)%1==0&&(e+=".00");let i=s<Object.keys(t).length-1?"; ":"";a+=`${e}${i}`,c+=`${n}${i}`})),r.custom.values=c,r.custom.keyTimes=a;let h=o("translate"==e?"animateTransform":"animate",r,i);return h=Object.assign(h,s),h},c=function(e,t,n,s=!1){return(e=s?Math.floor(e):e)>n?n:e<t?t:e},a=function(e,t,n){n||"undefined"==typeof document||(n=document);let i=n.createElement(e);return s(i,t),i};const h=function(e,t={}){document.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0,composed:!1}))};var l=function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toFrequency()},u=function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toFrequency()};function f(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","filter");return n.setAttribute("id",e),n.setAttribute("filterUnits",t),n}function p(e,t,n){const s=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");return s.setAttribute("id",e),s.setAttribute("type",t),s.setAttribute("values",n),s}function d(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");return t.setAttribute("id",e),t}function m(e){const t=document.createElementNS("http://www.w3.org/2000/svg","animate");return Object.keys(e).forEach((n=>{t.setAttribute(n,e[n])})),t}function y(e){const t=f(e.id,e.filterUnits),n=d("feComponentTransfer1");return t.appendChild(n),Object.keys(e.components).forEach((n=>{const s=e.components[n],i=p(s.id,s.type,s.values);t.appendChild(i)})),Object.keys(e.animations).length>0&&Object.keys(e.animations).forEach((n=>{const s=m(e.animations[n]);t.appendChild(s)})),t}function g(e){return parseInt(e,16)/255}function b(e){let t=Math.round(255*e).toString(16);return t=1===t.length?`0${t}`:t,t}const v=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e);console.log("running cm-toolbox");var w={CSSToggle:class{constructor(e,t=!1,n=.1,s=.3,i="hc--light",o="fill"){this.element=e,this.on=t,this.attack=n,this.release=s,this.effectClass=i}toggle(){this.on=!this.on;let{element:e,on:t,attack:n,release:s,effectClass:i}=this;e.style.transition=`fill ${t?n:s}s ease`,e.classList[t?"add":"remove"](i)}trigger(e,t=!0){this.on=e;let{element:n,attack:s,release:i,effectClass:o}=this;n.style.transition=`fill ${e?s:i}s ease`,n.classList[e?"add":"remove"](o)}set attack(e){this._attack=e}set release(e){this._release=e}},addAnimation:function(e,t,n,s,i={},o){o||"undefined"==typeof document||(o=document);let c,a="object"==typeof e?e:o.getElementById(e);if("object"==typeof arguments[1]){let e={custom:{}};Object.assign(e,arguments[1]),arguments.length>2&&(o=arguments[2]),"id"in e.custom||(e.custom.id=`${a.id}_${t}`),c=r(e,o)}else"id"in i||(i.id=`${a.id}_${t}`),c=r(t,n,s,i,o);return a.appendChild(c),c},constrain:c,create:a,createFilter:function(e,t){let n={filter:o("filter",{id:e,custom:{filterUnits:"objectBoundingBox",x:"0",y:"0",width:"100%",height:"100%"}}),animation:{},update:{}};return"string"==typeof t&&(t=[t]),t.forEach((s=>{n[s]=o("feColorMatrix",{id:`${e}_${s}`,custom:{type:t,in:"SourceGraphic",values:0}}),n.filter.appendChild(n[s]),n.animation[s]=r("values",[[0,0],[1,1]],.1),n[s].appendChild(n.animation[s]),n.update[s]=function(e,t="unspecified",i="unspecified"){"unspecified"==i&&(i=n[s].values.animVal.getItem("value").value),"unspecified"!=t&&n.animation[s].setAttribute("dur",`${t}s`),n.animation[s].setAttribute("values",`${i};${e}`),console.log(n.animation[s]),n.animation[s].beginElement()}})),n},createAnimation:r,createNS:o,emit:h,ftos:function(e,t=0){return sym=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toNote()},getTranslate:e=>{const t=getComputedStyle(e).transform,{e:n,f:s}="none"==t?{e:0,f:0}:new DOMMatrix(t);return{x:n,y:s}},hexToInt:function(e){let t=[0,0];for(let n=0;n<2;n++)t[n]=e.charCodeAt(n),t[n]-=t[n]>=65?55:48;return t[0]*=16,t[0]+t[1]},interpolate:function(e,t,n,s=!1){let i=(1-n)*e+n*t;return i=s?Math.floor(i):i,i},intToHex:function(e){let t=[0,0];t[0]=Math.floor(e/16),t[1]=e%16;for(let e in t)t[e]=t[e]>9?String.fromCharCode(t[e]+55):t[e];return`${t[0]}${t[1]}`},map:function(e,t,n,s,i,o=!1,r=!1){return e-=t,e*=i-s,e/=n-t,e+=t,e=r?Math.floor(e):e,o?c(e,s,i):e},mtof:l,mtos:function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toNote()},populate:function(e,t,n=!1,s="option"){t.forEach((t=>{e.appendChild(a(s,{value:t,innerHTML:t})),0!=n&&(e.value=n)}))},rot:function(e,t){let n=[e.slice(t),e.slice(0,t)];return n[0].concat(n[1])},set:s,setInTree:function(e=[],t=0,n=this){"string"==typeof e&&(e=e.split("_"));var s=n;e.forEach(((e,t,n)=>{t<n.length-1&&(s=s[e])})),console.log(s,t),s[e[e.length-1]]=t},setNS:function(e,t){Object.entries(t).forEach((t=>{let[n,s]=t;switch(n){case"custom":Object.entries(s).forEach((t=>{e.setAttributeNS(xmlns,...t)}));break;case"style":Object.entries(s).forEach((t=>e.style[t[0]]=t[1]));break;default:e[n]=s}}))},stom:function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toMidi()},stof:u,toggleFullscreen:()=>document.fullscreenElement?(document.exitFullscreen(),!0):document.webkitFullscreenElement?(document.webkitExitFullscreen(),!0):document.documentElement.requestFullscreen?(document.documentElement.requestFullscreen(),!0):document.documentElement.webkitRequestFullscreen?(document.documentElement.webkitRequestFullscreen(),!0):(window.top!=window.self?window.top.location.href=window.location.href:window.history.back(),!1),transposeForPlayer:function(e,t){return"string"==typeof e?e=u(e):"number"==typeof e&&(e=l(e)),"string"==typeof t?t=u(t):"number"==typeof t&&(t=l(t)),e/t},v:function(e){return Tone.gainToDb(e)},within:function(e=0,t=0,n={left:0,right:0,top:0,bottom:0}){let s={left:e>=n.left,right:e<=n.right,top:t>=n.top,bottom:t<=n.bottom},i=[];return Object.keys(n).forEach((e=>{e in s&&i.push(s[e])})),i.every((e=>!0===e))},generateSVGFilter:f,generateFeColorMatrix:p,generateFeComponentTransfer:d,generateAnimate:m,addFiltersToDefs:function(e,t=document.querySelector("svg")){Object.keys(e).forEach((t=>{const n=y(e[t]);if(!document.querySelector("svg defs")){const e=document.createElementNS("http://www.w3.org/2000/svg","defs");document.querySelector("svg").insertBefore(e,document.querySelector("svg").firstChild)}document.querySelector("svg defs").appendChild(n)}));const n=t.cloneNode(!0);t.parentNode.replaceChild(n,t)},filterFromDictionary:y,applyFilter:function(e,t){const n=t.cloneNode(!0);n.setAttribute("filter",`url(#${e.id})`),t.parentNode.replaceChild(n,t),document.querySelector(`#${e.id}`).querySelectorAll("animate").forEach((e=>{e.setAttribute("href",`#${e.getAttribute("href").slice(1)}${t.id}`),e.setAttribute("id",`${e.getAttribute("id")}${t.id}`)}))},setSvgTextClass:function(e,t,n="selected"){Array.from(e.children).filter((e=>"svg"==e.tagName)).forEach((e=>{e.querySelectorAll("text").forEach((e=>{e.classList[t](n)}))}))},hexToRGB:function(e){return[g(e.slice(1,3)),g(e.slice(3,5)),g(e.slice(5,7))]},RGBToHSL:function(e,t,n){let s,i,o=Math.max(e,t,n),r=Math.min(e,t,n),c=(o+r)/2;if(o==r)s=i=0;else{var a=o-r;switch(i=c<.5?a/(o+r):a/(2-o-r),o){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return s=Math.round(360*s),i=Math.round(100*i),c=Math.round(100*c),[s,i,c]},HSLToHex:function(e,t,n){let s;if(e/=360,n/=100,0==(t/=100))s=[n,n,n];else{const i=n<.5?n*(1+t):n+t-n*t,o=2*n-i;s=[v(o,i,e+1/3),v(o,i,e),v(o,i,e-1/3)]}return s=s.map((e=>b(e))),`#${s.join("")}`},floatToHexDigit:b,hexDigitToFloat:g};"undefined"!=typeof module&&module.exports?(console.log("cm-toolbox running in node...success!"),module.exports=w):"undefined"!=typeof globalThis?globalThis.CM=w:"undefined"!=typeof window&&(window.CM=w)}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{Decoder:()=>he,Encoder:()=>ae,PacketType:()=>ce,protocol:()=>re});class t{constructor(e=["all"]){this.devices=e,this.map={},this.init()}}Object.assign(t.prototype,{process:function(e){let[t,n,s]=e.data;if(t>=176&&t<=191){let e=t-176;console.log("channel:",t-175,"cc:",n,"value:",s),this.map[e].cc[n](s)}else if(t>=144&&t<=159){let e=t-144;this.processNote(e,n,s),this.map[e].note[n](s)}else if(t>=128&&t<=143){let e=t-128;"undefined"==s&&(s=0),this.processNote(e,n,0),this.map[e].noteOff[n](0),this.map[e].note[n](0)}},init:function(){for(let e=0;e<16;e++){this.map[e]={},this.map[e].cc=[],this.map[e].note=[],this.map[e].noteOff=[],this.map[e].noteRange={};for(let t=0;t<128;t++)this.map[e].cc[t]=function(){},this.map[e].note[t]=function(){},this.map[e].noteOff[t]=function(){}}},success:function(e){for(let t of e.inputs.values())t.onmidimessage=this.process.bind(this),console.log("MIDI Mapper listening:",t.name,t)},failure:function(){console.log("No MIDI device available")},listen:function(){navigator.requestMIDIAccess().then(this.success.bind(this),this.failure.bind(this))},assign:function(e,t,n,s){if(16==e)for(let e=0;e<16;e++)this.map[e][t][n]=s;else this.map[e][t][n]=s;return this},assignRange:function(e,t,n){"full"!=t&&"all"!=t||(t="0,127"),this.map[e].noteRange[t]=n},getRanges:function(e,t,n){return Object.entries(this.map[e].noteRange).filter((([e,n])=>{let s=e.split(",").map((e=>parseFloat(e)));return t>=s[0]&&t<=s[1]})).map((e=>e[1]))},processRange:function(e,t,n){e.forEach((e=>e(t,n)))},processNote:function(e,t,n){this.processRange(this.getRanges(...arguments),t,n)}});const s=t,i=Object.create(null);i.open="0",i.close="1",i.ping="2",i.pong="3",i.message="4",i.upgrade="5",i.noop="6";const o=Object.create(null);Object.keys(i).forEach((e=>{o[i[e]]=e}));const r={type:"error",data:"parser error"},c="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),a="function"==typeof ArrayBuffer,h=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)},l=({type:e,data:t},n,s)=>{return c&&t instanceof Blob?n?s(t):h(t,s):a&&(t instanceof ArrayBuffer||(o=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer))?n?s(t):h(new Blob([t]),s):s(i[e]+(t||""));var o},u="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<64;e++)u["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(e)]=e;const f="function"==typeof ArrayBuffer,p=(e,t)=>{if(f){const n=(e=>{let t,n,s,i,o,r=.75*e.length,c=e.length,a=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--);const h=new ArrayBuffer(r),l=new Uint8Array(h);for(t=0;t<c;t+=4)n=u[e.charCodeAt(t)],s=u[e.charCodeAt(t+1)],i=u[e.charCodeAt(t+2)],o=u[e.charCodeAt(t+3)],l[a++]=n<<2|s>>4,l[a++]=(15&s)<<4|i>>2,l[a++]=(3&i)<<6|63&o;return h})(e);return d(n,t)}return{base64:!0,data:e}},d=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,m=(e,t)=>{if("string"!=typeof e)return{type:"message",data:d(e,t)};const n=e.charAt(0);return"b"===n?{type:"message",data:p(e.substring(1),t)}:o[n]?e.length>1?{type:o[n],data:e.substring(1)}:{type:o[n]}:r},y=String.fromCharCode(30);function g(e){if(e)return function(e){for(var t in g.prototype)e[t]=g.prototype[t];return e}(e)}g.prototype.on=g.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},g.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},g.prototype.off=g.prototype.removeListener=g.prototype.removeAllListeners=g.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,s=this._callbacks["$"+e];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<s.length;i++)if((n=s[i])===t||n.fn===t){s.splice(i,1);break}return 0===s.length&&delete this._callbacks["$"+e],this},g.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){s=0;for(var i=(n=n.slice(0)).length;s<i;++s)n[s].apply(this,t)}return this},g.prototype.emitReserved=g.prototype.emit,g.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},g.prototype.hasListeners=function(e){return!!this.listeners(e).length};const b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function v(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const w=setTimeout,E=clearTimeout;function k(e,t){t.useNativeTimers?(e.setTimeoutFn=w.bind(b),e.clearTimeoutFn=E.bind(b)):(e.setTimeoutFn=setTimeout.bind(b),e.clearTimeoutFn=clearTimeout.bind(b))}class A extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class O extends g{constructor(e){super(),this.writable=!1,k(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new A(e,t,n)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=m(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const C="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),T=64,x={};let j,S=0,_=0;function R(e){let t="";do{t=C[e%T]+t,e=Math.floor(e/T)}while(e>0);return t}function N(){const e=R(+new Date);return e!==j?(S=0,j=e):e+"."+R(S++)}for(;_<T;_++)x[C[_]]=_;function B(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}let F=!1;try{F="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}const q=F;function D(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||q))return new XMLHttpRequest}catch(e){}if(!t)try{return new(b[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}function L(){}const M=null!=new D({xdomain:!1}).responseType;class P extends g{constructor(e,t){super(),k(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=v(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new D(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=P.requestsCount++,P.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=L,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete P.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function $(){for(let e in P.requests)P.requests.hasOwnProperty(e)&&P.requests[e].abort()}P.requestsCount=0,P.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",$):"function"==typeof addEventListener&&addEventListener("onpagehide"in b?"pagehide":"unload",$,!1));const I="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Y=b.WebSocket||b.MozWebSocket,V="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),U={websocket:class extends O{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=V?{}:v(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=V?new Y(e,t,n):t?new Y(e,t):new Y(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;l(n,this.supportsBinary,(e=>{try{this.ws.send(e)}catch(e){}s&&I((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||(e.b64=1);const s=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!Y}},polling:class extends O{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=M&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(y),s=[];for(let e=0;e<n.length;e++){const i=m(n[e],t);if(s.push(i),"error"===i.type)break}return s})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach(((e,o)=>{l(e,!1,(e=>{s[o]=e,++i===n&&t(s.join(y))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=N()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const s=B(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new P(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}},H=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,X=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function z(e){const t=e,n=e.indexOf("["),s=e.indexOf("]");-1!=n&&-1!=s&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=H.exec(e||""),o={},r=14;for(;r--;)o[X[r]]=i[r]||"";return-1!=n&&-1!=s&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){const n=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1),"/"==t.slice(-1)&&n.splice(n.length-1,1),n}(0,o.path),o.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,s){t&&(n[t]=s)})),n}(0,o.query),o}class G extends g{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=z(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=z(t.host).host),k(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let e=0,s=n.length;e<s;e++){let s=n[e].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new U[e](n)}open(){let e;if(this.opts.rememberUpgrade&&G.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;G.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;G.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){n||(n=!0,h(),t.close(),t=null)}const o=e=>{const n=new Error("probe error: "+e);n.transport=t.name,i(),this.emitReserved("upgradeError",n)};function r(){o("transport closed")}function c(){o("socket closed")}function a(e){t&&e.name!==t.name&&i()}const h=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",r),this.off("close",c),this.off("upgrading",a)};t.once("open",s),t.once("error",o),t.once("close",r),this.once("close",c),this.once("upgrading",a),t.open()}onOpen(){if(this.readyState="open",G.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(e+="string"==typeof(t=s)?function(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof n&&(s=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){G.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}G.protocol=4,G.protocol;const K="function"==typeof ArrayBuffer,W=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,J=Object.prototype.toString,Q="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===J.call(Blob),Z="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===J.call(File);function ee(e){return K&&(e instanceof ArrayBuffer||W(e))||Q&&e instanceof Blob||Z&&e instanceof File}function te(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(te(e[t]))return!0;return!1}if(ee(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return te(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&te(e[t]))return!0;return!1}function ne(e){const t=[],n=e.data,s=e;return s.data=se(n,t),s.attachments=t.length,{packet:s,buffers:t}}function se(e,t){if(!e)return e;if(ee(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=se(e[s],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=se(e[s],t));return n}return e}function ie(e,t){return e.data=oe(e.data,t),delete e.attachments,e}function oe(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=oe(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=oe(e[n],t));return e}const re=5;var ce;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(ce||(ce={}));class ae{constructor(e){this.replacer=e}encode(e){return e.type!==ce.EVENT&&e.type!==ce.ACK||!te(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===ce.EVENT?ce.BINARY_EVENT:ce.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==ce.BINARY_EVENT&&e.type!==ce.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ne(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}class he extends g{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===ce.BINARY_EVENT;n||t.type===ce.BINARY_ACK?(t.type=n?ce.EVENT:ce.ACK,this.reconstructor=new le(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!ee(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===ce[n.type])throw new Error("unknown packet type "+n.type);if(n.type===ce.BINARY_EVENT||n.type===ce.BINARY_ACK){const s=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(s,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const s=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(s,t)}else n.nsp="/";const s=e.charAt(t+1);if(""!==s&&Number(s)==s){const s=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(!he.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case ce.CONNECT:return"object"==typeof t;case ce.DISCONNECT:return void 0===t;case ce.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case ce.EVENT:case ce.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case ce.ACK:case ce.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class le{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ie(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ue(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const fe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class pe extends g{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ue(e,"open",this.onopen.bind(this)),ue(e,"packet",this.onpacket.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(fe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const n={type:ce.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,s=t.pop();this._registerAckCallback(e,s),n.id=e}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(void 0===n)return void(this.acks[e]=t);const s=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:ce.CONNECT,data:e})})):this.packet({type:ce.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case ce.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ce.EVENT:case ce.BINARY_EVENT:this.onevent(e);break;case ce.ACK:case ce.BINARY_ACK:this.onack(e);break;case ce.DISCONNECT:this.ondisconnect();break;case ce.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:ce.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ce.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function de(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}de.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},de.prototype.reset=function(){this.attempts=0},de.prototype.setMin=function(e){this.ms=e},de.prototype.setMax=function(e){this.max=e},de.prototype.setJitter=function(e){this.jitter=e};class me extends g{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(n=t,t=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,k(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=n.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new de({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||e;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new G(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=ue(t,"open",(function(){n.onopen(),e&&e()})),i=ue(t,"error",(t=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",t),e?e(t):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&s();const n=this.setTimeoutFn((()=>{s(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(s),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ue(e,"ping",this.onping.bind(this)),ue(e,"data",this.ondata.bind(this)),ue(e,"error",this.onerror.bind(this)),ue(e,"close",this.onclose.bind(this)),ue(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){I((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new pe(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const e of t)if(this.nsps[e].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ye={};function ge(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let s=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),s=z(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+t,s.href=s.protocol+"://"+i+(n&&n.port===s.port?"":":"+s.port),s}(e,(t=t||{}).path||"/socket.io"),s=n.source,i=n.id,o=n.path,r=ye[i]&&o in ye[i].nsps;let c;return t.forceNew||t["force new connection"]||!1===t.multiplex||r?c=new me(s,t):(ye[i]||(ye[i]=new me(s,t)),c=ye[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(ge,{Manager:me,Socket:pe,io:ge,connect:ge});const be="https://www.btb.software/";class ve{constructor(){console.log("url",be),this.socket=ge.connect(be,{transports:["websocket"]}),this.out={note:this.emitNote.bind(this),cc:this.emitCC.bind(this)},this.in={note:this.onNote,cc:this.onCC}}setPath(e="default"){this.path=e}emitMidi(e,t){this.socket.emit("midi",t)}emitNote(e,t,n){let s={message:[e-=e>=144?144:0,t,n],type:"note",ramp:0,path:this.path};this.socket.emit("midi",s)}emitCC(e,t,n){let s={message:[e-=e>=144?144:0,t,n],type:"cc",ramp:0,path:this.path};this.socket.emit("midi",s)}listen(){this.socket.on("midi",(e=>{Object.keys(this.in).includes(e.type)?this.in[e.type](e.message,e.ramp):console.log("unknown type of midi message",e.type)})),Object.values(this.in).forEach(((e,t)=>{}))}onNote(e,t){console.log("onNote",e,t)}onCC(e,t){}}n(876),"undefined"!=typeof window&&(console.log("socket-mapper running in browser..."),window.SocketMapper=ve);const we=ve;var Ee=function(e,t){Object.entries(t).forEach((t=>{let[n,s]=t;switch(n){case"custom":Object.entries(s).forEach((t=>e.setAttribute(...t)));break;case"style":Object.entries(s).forEach((t=>e.style[t[0]]=t[1]));break;case"dataset":Object.entries(s).forEach((t=>e.dataset[t[0]]=t[1]));break;default:e[n]=s}}))},ke=ke||"http://www.w3.org/2000/svg",Ae=function(e,t,n=document){let s=n.createElementNS(ke,e);return Ee(s,t),s},Oe=function(e,t,n,s={},i){i||"undefined"==typeof document||(i=document);let o={custom:{attributeName:"fill",begin:"indefinite",repeatCount:"1",dur:"1s",fill:"freeze",keyTimes:"0; 1",values:"red; blue"}};"object"==typeof arguments[0]&&(Object.assign(o.custom,arguments[0].custom),"dur"in o.custom||(o.custom.dur=`${arguments[0].duration}s`),t=arguments[0].events,n=arguments[0].duration,arguments.length>1&&(i=arguments[1]));let r="",c="";if(!Array.isArray(t)){let e=[];Object.keys(t).forEach((n=>{e.push([n,t[n]])})),(t=e).sort(((e,t)=>e[0]-t[0]))}t.forEach((([e,n],s)=>{parseFloat(e)%1==0&&(e+=".00");let i=s<Object.keys(t).length-1?"; ":"";c+=`${e}${i}`,r+=`${n}${i}`})),o.custom.values=r,o.custom.keyTimes=c;let a=Ae("translate"==e?"animateTransform":"animate",o,i);return a=Object.assign(a,s),a},Ce=function(e,t,n,s=!1){return(e=s?Math.floor(e):e)>n?n:e<t?t:e},Te=function(e,t,n){n||"undefined"==typeof document||(n=document);let s=n.createElement(e);return Ee(s,t),s},xe=function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toFrequency()},je=function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toFrequency()};function Se(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","filter");return n.setAttribute("id",e),n.setAttribute("filterUnits",t),n}function _e(e,t,n){const s=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");return s.setAttribute("id",e),s.setAttribute("type",t),s.setAttribute("values",n),s}function Re(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");return t.setAttribute("id",e),t}function Ne(e){const t=document.createElementNS("http://www.w3.org/2000/svg","animate");return Object.keys(e).forEach((n=>{t.setAttribute(n,e[n])})),t}function Be(e){const t=Se(e.id,e.filterUnits),n=Re("feComponentTransfer1");return t.appendChild(n),Object.keys(e.components).forEach((n=>{const s=e.components[n],i=_e(s.id,s.type,s.values);t.appendChild(i)})),Object.keys(e.animations).length>0&&Object.keys(e.animations).forEach((n=>{const s=Ne(e.animations[n]);t.appendChild(s)})),t}console.log("running cm-toolbox");var Fe={CSSToggle:class{constructor(e,t=!1,n=.1,s=.3,i="hc--light",o="fill"){this.element=e,this.on=t,this.attack=n,this.release=s,this.effectClass=i}toggle(){this.on=!this.on;let{element:e,on:t,attack:n,release:s,effectClass:i}=this;e.style.transition=`fill ${t?n:s}s ease`,e.classList[t?"add":"remove"](i)}trigger(e,t=!0){this.on=e;let{element:n,attack:s,release:i,effectClass:o}=this;n.style.transition=`fill ${e?s:i}s ease`,n.classList[e?"add":"remove"](o)}set attack(e){this._attack=e}set release(e){this._release=e}},addAnimation:function(e,t,n,s,i={},o){o||"undefined"==typeof document||(o=document);let r,c="object"==typeof e?e:o.getElementById(e);if("object"==typeof arguments[1]){let e={custom:{}};Object.assign(e,arguments[1]),arguments.length>2&&(o=arguments[2]),"id"in e.custom||(e.custom.id=`${c.id}_${t}`),r=Oe(e,o)}else"id"in i||(i.id=`${c.id}_${t}`),r=Oe(t,n,s,i,o);return c.appendChild(r),r},constrain:Ce,create:Te,createFilter:function(e,t){let n={filter:Ae("filter",{id:e,custom:{filterUnits:"objectBoundingBox",x:"0",y:"0",width:"100%",height:"100%"}}),animation:{},update:{}};return"string"==typeof t&&(t=[t]),t.forEach((s=>{n[s]=Ae("feColorMatrix",{id:`${e}_${s}`,custom:{type:t,in:"SourceGraphic",values:0}}),n.filter.appendChild(n[s]),n.animation[s]=Oe("values",[[0,0],[1,1]],.1),n[s].appendChild(n.animation[s]),n.update[s]=function(e,t="unspecified",i="unspecified"){"unspecified"==i&&(i=n[s].values.animVal.getItem("value").value),"unspecified"!=t&&n.animation[s].setAttribute("dur",`${t}s`),n.animation[s].setAttribute("values",`${i};${e}`),console.log(n.animation[s]),n.animation[s].beginElement()}})),n},createAnimation:Oe,createNS:Ae,ftos:function(e,t=0){return sym=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toNote()},getTranslate:e=>{const t=getComputedStyle(e).transform,{e:n,f:s}="none"==t?{e:0,f:0}:new DOMMatrix(t);return{x:n,y:s}},hexToInt:function(e){let t=[0,0];for(let n=0;n<2;n++)t[n]=e.charCodeAt(n),t[n]-=t[n]>=65?55:48;return t[0]*=16,t[0]+t[1]},interpolate:function(e,t,n,s=!1){let i=(1-n)*e+n*t;return i=s?Math.floor(i):i,i},intToHex:function(e){let t=[0,0];t[0]=Math.floor(e/16),t[1]=e%16;for(let e in t)t[e]=t[e]>9?String.fromCharCode(t[e]+55):t[e];return`${t[0]}${t[1]}`},map:function(e,t,n,s,i,o=!1,r=!1){return e-=t,e*=i-s,e/=n-t,e+=t,e=r?Math.floor(e):e,o?Ce(e,s,i):e},mtof:xe,mtos:function(e,t=0){return e=Tone.Frequency(e,"midi").transpose(t),Tone.Frequency(e,"midi").toNote()},populate:function(e,t,n=!1,s="option"){t.forEach((t=>{e.appendChild(Te(s,{value:t,innerHTML:t})),0!=n&&(e.value=n)}))},rot:function(e,t){let n=[e.slice(t),e.slice(0,t)];return n[0].concat(n[1])},set:Ee,setInTree:function(e=[],t=0,n=this){"string"==typeof e&&(e=e.split("_"));var s=n;e.forEach(((e,t,n)=>{t<n.length-1&&(s=s[e])})),console.log(s,t),s[e[e.length-1]]=t},setNS:function(e,t){Object.entries(t).forEach((t=>{let[n,s]=t;switch(n){case"custom":Object.entries(s).forEach((t=>{e.setAttributeNS(xmlns,...t)}));break;case"style":Object.entries(s).forEach((t=>e.style[t[0]]=t[1]));break;default:e[n]=s}}))},stom:function(e,t=0){return e=Tone.Frequency(e).transpose(t),Tone.Frequency(e).toMidi()},stof:je,transposeForPlayer:function(e,t){return"string"==typeof e?e=je(e):"number"==typeof e&&(e=xe(e)),"string"==typeof t?t=je(t):"number"==typeof t&&(t=xe(t)),e/t},v:function(e){return Tone.gainToDb(e)},within:function(e=0,t=0,n={left:0,right:0,top:0,bottom:0}){let s={left:e>=n.left,right:e<=n.right,top:t>=n.top,bottom:t<=n.bottom},i=[];return Object.keys(n).forEach((e=>{e in s&&i.push(s[e])})),i.every((e=>!0===e))},generateSVGFilter:Se,generateFeColorMatrix:_e,generateFeComponentTransfer:Re,generateAnimate:Ne,addFiltersToDefs:function(e,t=document.querySelector("svg")){Object.keys(e).forEach((t=>{const n=Be(e[t]);if(!document.querySelector("svg defs")){const e=document.createElementNS("http://www.w3.org/2000/svg","defs");document.querySelector("svg").insertBefore(e,document.querySelector("svg").firstChild)}document.querySelector("svg defs").appendChild(n)}));const n=t.cloneNode(!0);t.parentNode.replaceChild(n,t)},filterFromDictionary:Be,applyFilter:function(e,t){const n=t.cloneNode(!0);n.setAttribute("filter",`url(#${e.id})`),t.parentNode.replaceChild(n,t),document.querySelector(`#${e.id}`).querySelectorAll("animate").forEach((e=>{e.setAttribute("href",`#${e.getAttribute("href").slice(1)}${t.id}`),e.setAttribute("id",`${e.getAttribute("id")}${t.id}`)}))}};"undefined"!=typeof module&&module.exports?(console.log("cm-toolbox running in node...success!"),module.exports=Fe):"undefined"!=typeof globalThis?globalThis.CM=Fe:"undefined"!=typeof window&&(window.CM=Fe);class qe{constructor(e={},t="serial_accelerometer",n=115200){this.port=null,this.baudRate=n,this.actions=e}}Object.assign(qe.prototype,{connect:async function(){try{this.port=await navigator.serial.requestPort(),await this.port.open({baudRate:this.baudRate}),this.encoder=new TextEncoderStream,this.encoder.readable.pipeTo(this.port.writable),this.writer=this.encoder.writable.getWriter(),this.listen()}catch(e){console.error(e)}},listen:async function(e=this.actions){try{for(this.decoder=new TextDecoderStream,this.port.readable.pipeTo(this.decoder.writable),this.reader=this.decoder.readable.getReader(),this.messageBuffer="";;){const{value:e,done:t}=await this.reader.read();if(t){this.reader.releaseLock();break}e&&(this.messageBuffer+=e,this.messageBuffer.includes("\r\n")&&(Object.entries(this.actions).forEach((([e,t])=>{if(this.messageBuffer.includes(e)){let n=this.messageBuffer.replace("\r\n","").replace(e,"").split(" ").map((e=>parseInt(e))).filter((e=>"number"==typeof e&&!isNaN(e)));document.dispatchEvent(new CustomEvent(t,{detail:{array:n},bubbles:!0,cancelable:!0,composed:!1}))}})),this.messageBuffer=""))}}catch(e){console.error(e)}},write:async function(e){try{await this.writer.write(e)}catch(e){console.error(e)}},writeQueue:async function(e=[]){try{for(let t of e)await this.writer.write(t)}catch(e){return console.error(e),!1}return!0},assign:function(e={}){Object.assign(this.actions,e)},assignRoute:function(e={}){this.assign(e)}});const De=qe;var Le=n(441);const Me={newton_12:{names:["Red","OrangeRed","Orange","Gold","Yellow","YellowGreen","Green","LightSeaGreen","Blue","BlueViolet","Indigo","Purple"],description:"Color wheel with added accidentals, based on Newton's system.",author:"Charles Matthews"},daze:{names:["Orange","Pale Orange","Magenta","Greenish Grey","Sea green","Yellow","Rust","Red","Lilac","Purple","Pale Green","Deep pool blue"],namesHTML:["Orange","NavajoWhite","Magenta","PaleGreen","Aqua","Yellow","Sienna","Red","Orchid","Purple","LimeGreen","DeepSkyBlue"],hex:["#ff9933","#ffcc99","#f85af8","#c3fcc8","#0cffff","#ffff03","#e0b5a2","#ff0101","#c37596","#cc66ff","#33cc33","#0783dc"],led:["#FFA500","#FFE4C4","#FF00FF","#18FB18","#00FFFF","#FFFF00","#A03211","#FF0000","#DA70D6","#800080","#00CD00","#00BFFF"],description:"Colour Pitch Assembly by Joel Daze.  Please reference this project if used.",author:"Joel Daze"},purples:{names:["Purple","Indigo","DarkViolet","BlueViolet","MediumSlateBlue","SlateBlue","MediumOrchid","Violet","Plum","Orchid","MediumPurple","DarkOrchid"],description:"A set of purples",author:"Charles Matthews"}};class Pe{constructor(){Object.assign(this,{pitch:-1,velocity:0,active:!1})}on(e,t){this.active=!0,Object.assign(this,{pitch:e,velocity:t})}off(){this.active=!1,Object.assign(this,{pitch:-1,velocity:0})}}function $e(e){return Object.keys(colours.lights)[e]}function Ie(){let{voices:e}=window.colours,t=e.voices;document.querySelectorAll(".testBar").forEach(((e,n)=>{e.style.backgroundColor=t[n].active?noteColours.daze.hex[t[n].pitch%12]:"black"}))}const Ye=function(){let{arduino:e,socket:t,voices:n}=window.colours;e.connect(),t.in.cc=e=>{let[t,s,i]=e;if(64==s)if(127==i)colours.hold=!0;else if(colours.hold&&0==i){n.flush(),colours.hold=!1,Ie(),n.voices.map((e=>e.pitch)).forEach(((e,t)=>{colours.lights[Object.keys(colours.lights)[t]].write=[0,0,0]})),processAll()}},t.in.note=e=>{let[t,s,i]=e;if(!i&&colours.hold)return;let o=n.update(s,i,!1);console.log("dmx voice number",o,$e(o)),colours.intensities[$e(o)]=i,colours.voices.voices.forEach(((e,t)=>{writeNoteColour(e.pitch,t)})),Ie()},t.listen()};function Ve(){let{socket:e}=colours,t=(new Tone.PolySynth).toMaster();Tone.start(),console.log("init"),e.listen(),e.in.note=e=>{let[n,s,i]=e;t[e[2]?"triggerAttack":"triggerRelease"](Tone.Frequency(s,"midi").toNote(),void 0,i/127)}}function Ue(e,t){let n=e[t];return"#"==n[0]&&(n=n.slice(1)),3==n.length&&(n=n.split("").map((e=>e+e)).join("")),n=n.match(/.{2}/g).map((e=>parseInt(e,16))),n}function He(e,t=0){let{always_on:n}=colours;t=parseInt(t)+1;let s=e.map(((e,n)=>`${n+t}:${e}`)).join("\n");return n&&(s+=`\n${t-1}:255\n`),s}function Xe(){let e,{queue:t,arduino:n,lights:s,audio:i,always_write:o}=colours;i.meter&&(e=1*Tone.dbToGain(i.meter.getLevel()),e>1&&(e=1)),Object.entries(s).forEach((([e,t])=>{t.join("")==colours.lights_last[e].join("")||(colours.queue.push(He(t,e)),colours.lights_last[e]=t)})),function(){let{arduino:e,initFlag:t,intensities:n}=colours;Object.entries(n).forEach((([e,t])=>{t==colours.intensities_last[e]||(colours.queue.push(`${e}:${t}\n`),colours.intensities_last[e]=t)}))}(),o&&ze()}function ze(){let{queue:e,arduino:t}=colours;e.length&&(t.writeQueue(e),colours.queue=[])}window.MidiMapper=s,window.colours={midi:new s,socket:new we,arduino:new De,voices:new class{constructor(e=4,t=!0){this.stealing=t,this.voices=[];for(let t=0;t<e;t++)this.voices.push(new Pe)}update(e,t,n=!1){let s=this.voices.filter((e=>e.active)),i=this.voices.find((t=>t.pitch==e));return t?(i?i.on(e,t):s.length==this.voices.length?this.stealing&&(i=this.steal(e,t)):(i=this.voices.find((e=>!e.active)),i.on(e,t)),n?this.voices:this.voices.indexOf(i)):(i&&i.off(),!!n&&this.voices)}steal(e,t){return this.voices[this.voices.length-1].on(e,t),this.voices[this.voices.length-1]}getVoice(e){return this.voices[e]}getVoices(){return this.voices}getActiveVoices(){return this.voices.filter((e=>e.active))}getInactiveVoices(){return this.voices.filter((e=>!e.active))}getActiveVoiceCount(){return this.voices.filter((e=>e.active)).length}flush(){this.voices.forEach((e=>e.off()))}}(4),touch:new Le,initFlag:!1,polyphony:4,lights:{1:[0,0,0],11:[0,0,0],22:[0,0,0],33:[0,0,0]},lights_last:{1:[0,0,0],11:[0,0,0],22:[0,0,0],33:[0,0,0]},intensities:{1:0,11:0,22:0,33:0},intensities_last:{1:0,11:0,22:0,33:0},decays:{1:0,11:0,22:0,33:0},always_on:!0,always_write:!0,use_velocity:!0,queue:[],audio:{},multiplier:1,hold:!1},document.querySelectorAll("#socketInit").forEach((e=>e.addEventListener("click",Ve))),document.querySelectorAll("#dmxInit").forEach((e=>e.addEventListener("click",Ye))),document.querySelectorAll("#flush").forEach((e=>e.addEventListener("click",colours.voices.flush))),document.querySelectorAll("#hold").forEach((e=>{e.addEventListener("input",(function(){!function(e){colours.hold=e}(this.checked)}))})),Object.assign(window,{getColour:Ue,formatColour:He,writeNoteColour:function(e=0,t=0){let n,s,{arduino:i,initFlag:o,lights:r}=colours;if(-1==e)n=[0,0,0];else{n=Ue(Me.daze.led,e%12);let t=colours.voices.voices.findIndex((t=>t.pitch==e));s=colours.voices.voices[t].velocity,console.log("intensity",s),n=n.map((e=>Math.floor(e*s/127)))}console.log("colour",n),colours.lights[Object.keys(r)[t]]=n,Xe()},start:function(){let{midi:e,socket:t,voices:n}=window.colours;Math.random().toString(36).slice(2),e.map[0].noteRange["0,127"]=function(e,s){let i=n.update(e,s,!0);document.querySelectorAll(".testBar").forEach(((e,t)=>{e.style.backgroundColor=i[t].active?noteColours.daze.hex[i[t].pitch%12]:"black"})),t.emitNote(0,e,s)},e.map[0].cc[64]=function(e){t.emitCC(0,64,e)},e.listen()},noteColours:Me,processQueue:function(){let{queue:e,arduino:t}=window.colours;e.length&&(t.writeQueue(e),e=[])},processAll:Xe,autoWrite:function(e=!0,t=30){colours.alwayws_write=e,e?colours.interval=setInterval(ze,t):clearInterval(colours.interval)},writeQueue:ze,initAudio:function(){colours.audio.mic=new Tone.UserMedia,colours.audio.meter=new Tone.Meter,colours.audio.mic.connect(colours.audio.meter),colours.audio.mic.open().then((()=>{}))}})})()})();